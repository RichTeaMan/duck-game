(this["webpackJsonpduck-game"]=this["webpackJsonpduck-game"]||[]).push([[0],{14:function(t,e,a){},15:function(t,e,a){},17:function(t,e,a){"use strict";a.r(e);var i=a(2),s=a.n(i),n=a(8),r=a.n(n),o=(a(14),a(15),a(6)),h=a(5),c=a(4),u=a(3),d=a(1),l=a(0);function m(t){return Math.floor(Math.random()*Math.floor(t))}var p=function(){function t(e,a,i,s){Object(d.a)(this,t),this.name=void 0,this.offset=void 0,this.x=void 0,this.y=void 0,this.opposite=void 0,this.name=e,this.offset=a,this.x=i,this.y=s}return Object(l.a)(t,null,[{key:"initialise",value:function(){t.west=new t("west",0,-2,0),t.northWest=new t("northWest",32,-2,-1),t.north=new t("north",64,0,-2),t.northEast=new t("northEast",96,2,-1),t.east=new t("east",128,2,0),t.southEast=new t("southEast",160,2,1),t.south=new t("south",192,0,2),t.southWest=new t("southWest",224,-2,1),t.west.opposite=t.east,t.northWest.opposite=t.southEast,t.north.opposite=t.south,t.northEast.opposite=t.southWest,t.east.opposite=t.west,t.southEast.opposite=t.northWest,t.south.opposite=t.north,t.southWest.opposite=t.northEast,t.map=[],t.map[t.west.name]=t.west,t.map[t.northWest.name]=t.northWest,t.map[t.north.name]=t.north,t.map[t.northEast.name]=t.northEast,t.map[t.east.name]=t.east,t.map[t.southEast.name]=t.southEast,t.map[t.south.name]=t.south,t.map[t.southWest.name]=t.southWest,t.list=[],t.list.push(t.west),t.list.push(t.northWest),t.list.push(t.north),t.list.push(t.northEast),t.list.push(t.east),t.list.push(t.southEast),t.list.push(t.south),t.list.push(t.southWest)}},{key:"get",value:function(e){return t.map[e]}},{key:"random",value:function(){var e=m(t.list.length);return t.list[e]}},{key:"determineFromVector",value:function(e){var a=Phaser.Math.Angle.Between(0,0,Math.abs(e.x),Math.abs(e.y)),i=[];e.x>=0&&e.y<0?i=[t.east,t.northEast,t.north]:e.x>=0&&e.y>=0?i=[t.east,t.southEast,t.south]:e.x<0&&e.y<0?i=[t.west,t.northWest,t.north]:e.x<0&&e.y>=0&&(i=[t.west,t.southWest,t.south]);var s=0;return a>1.178097?s=2:a>.3926991&&(s=1),i[s]}}]),t}();p.west=void 0,p.northWest=void 0,p.north=void 0,p.northEast=void 0,p.east=void 0,p.southEast=void 0,p.south=void 0,p.southWest=void 0,p.map=void 0,p.list=void 0,p.initialise();var g,f=function(){function t(e,a,i,s){Object(d.a)(this,t),this.image=void 0,this.isDestroyed=!1,this.image=e.scene.add.image(i,s,a)}return Object(l.a)(t,[{key:"update",value:function(){}},{key:"destroy",value:function(){this.isDestroyed=!0,this.image&&this.image.destroy()}},{key:"distanceFromEntity",value:function(t){return Phaser.Math.Distance.Between(this.x,this.y,t.x,t.y)}},{key:"vectorToEntity",value:function(t,e){return this.vectorToTarget(t.x,t.y,e)}},{key:"vectorToTarget",value:function(t,e,a){var i=t-this.x,s=e-this.y,n=Phaser.Math.Angle.Between(this.x,this.y,t,e),r=Math.cos(n),o=Math.sin(n),h=Math.abs(r)+Math.abs(o),c=r/h*a,u=o/h*a;return(c>10||u>10)&&(console.error("Spurious vectorToTargetResult - C: ".concat(t,", ").concat(e," | A: ").concat(Phaser.Math.RadToDeg(n)," | ").concat(i,", ").concat(s," | ").concat(c,", ").concat(u)),c>a?c=a:c<-a&&(c=-a),u>a?u=a:u<-a&&(u=-a)),new Phaser.Math.Vector2(c,u)}},{key:"x",get:function(){return this.image.x},set:function(t){this.image.x=t}},{key:"y",get:function(){return this.image.y},set:function(t){this.image.y=t}}]),t}();!function(t){t[t.Food=0]="Food",t[t.Duck=1]="Duck",t[t.Invisible=2]="Invisible"}(g||(g={}));var v=function(t){Object(c.a)(a,t);var e=Object(u.a)(a);function a(t,i,s){var n;return Object(d.a)(this,a),(n=e.call(this,t,"target",i,s)).image.depth=2e3,n.image.setVisible(t.debug.showTargets),n}return Object(l.a)(a,[{key:"entityType",value:function(){return g.Invisible}},{key:"update",value:function(){}}]),a}(f),y={idle:{startFrame:0,endFrame:4,speed:.2},walk:{startFrame:0,endFrame:4,speed:.1},feed:{startFrame:5,endFrame:7,speed:.8},die:{startFrame:20,endFrame:28,speed:.2},shoot:{startFrame:28,endFrame:32,speed:.1}},w=function(){function t(){Object(d.a)(this,t)}return Object(l.a)(t,null,[{key:"random",value:function(){return t.duckTypes[m(t.duckTypes.length)]}}]),t}();w.duckTypes=["white","mallard"];var k,b,E,F=function(t){Object(c.a)(a,t);var e=Object(u.a)(a);function a(t,i,s,n){var r;return Object(d.a)(this,a),(r=e.call(this,t,"duck-".concat(n),i,s)).motion=void 0,r.anim=void 0,r.direction=p.random(),r.speed=void 0,r.f=void 0,r.target=null,r.vector=null,r.gameState=void 0,r.animationStep=1,r.active=!0,r.idleTicks=0,r.motion="walk",r.anim=y[r.motion],r.speed=r.anim.speed,r.f=r.anim.startFrame,r.gameState=t,r.gameState.scene.time.delayedCall(1e3*r.anim.speed,r.changeFrame,[],Object(h.a)(r)),r}return Object(l.a)(a,[{key:"entityType",value:function(){return g.Duck}},{key:"startWalkAnimation",value:function(){this.f=y.walk.startFrame,this.anim=y.walk,this.animationStep=1,this.motion="walk",this.changeFrame(),this.active=!0}},{key:"startFeedAnimation",value:function(){this.f=y.feed.startFrame,this.anim=y.feed,this.animationStep=1,this.motion="feed",this.changeFrame(),this.active=!1}},{key:"changeFrame",value:function(){var t=this.anim.speed;if(this.image.depth=this.y+256,this.f>this.anim.endFrame||this.f<0)switch(this.motion){case"walk":this.animationStep=-this.animationStep,this.f+=2*this.animationStep;break;case"feed":return void this.gameState.scene.time.delayedCall(1e3*t,this.startWalkAnimation,[],this);case"idle":t=.5+Math.random(),this.gameState.scene.time.delayedCall(1e3*t,this.resetAnimation,[],this);break;case"die":t=6+6*Math.random(),this.gameState.scene.time.delayedCall(1e3*t,this.resetAnimation,[],this)}this.image.frame=this.image.texture.get(this.direction.offset+this.f),this.gameState.scene.time.delayedCall(1e3*t,this.changeFrame,[],this),this.f+=this.animationStep}},{key:"resetAnimation",value:function(){}},{key:"move",value:function(t,e){return!!this.gameState.isPointWater(this.x+t,this.y+e)&&(this.x+=t,this.y+=e,!0)}},{key:"update",value:function(){var t=this;if(this.active){if(null==this.target||this.target.isDestroyed||this.target.entityType()!==g.Food){if(this.gameState.fetchFood().length>0){var e,a=this.gameState.fetchFood().map((function(e){return{distance:t.distanceFromEntity(e)+m(30),target:e}})).sort((function(t){return t.distance})).reverse()[0];if(a.distance<250)null===(e=this.target)||void 0===e||e.destroy(),this.target=a.target,this.vector=this.vectorToEntity(this.target,5)}if(null==this.target){var i=(s=this.gameState.waterTiles)[m(s.length)];this.target=this.gameState.addEntity(new v(this.gameState,i.x,i.y)),this.vector=this.vectorToEntity(this.target,1)}this.direction=p.determineFromVector(this.vector)}var s;if(this.distanceFromEntity(this.target)<2.5)return this.target.destroy(),this.target.entityType()===g.Food&&this.startFeedAnimation(),void(this.target=null);this.x+=this.vector.x,this.y+=this.vector.y,this.image.depth=this.y+128}}}]),a}(f),T=function(t){Object(c.a)(a,t);var e=Object(u.a)(a);function a(t,i,s,n){var r;return Object(d.a)(this,a),(r=e.call(this,t,i,s,n)).start=0,r.image.depth=n+32,r}return Object(l.a)(a,null,[{key:"createBread",value:function(t,e,i){var s=new a(t,"bread",e,i);return s.image.scale=.2,t.entities.push(s),s}}]),Object(l.a)(a,[{key:"entityType",value:function(){return g.Food}},{key:"update",value:function(){this.start++,this.start>200&&this.destroy()}}]),a}(f),W=function(){function t(e){Object(d.a)(this,t),this.scene=void 0,this.cursors=void 0,this.entities=[],this.waterTiles=[],this.debug={showTargets:!1},this.scene=e,this.cursors=e.input.keyboard.createCursorKeys()}return Object(l.a)(t,[{key:"update",value:function(){this.entities.forEach((function(t){t.update()}))}},{key:"pruneEntities",value:function(){var t=[];this.entities.forEach((function(e){e.isDestroyed||t.push(e)})),this.entities=t}},{key:"fetchFood",value:function(){return this.entities.filter((function(t){return t.entityType()===g.Food&&!t.isDestroyed}))}},{key:"addEntity",value:function(t){return this.entities.push(t),t}},{key:"showWaterCollision",value:function(){for(var t=0;t<this.waterTiles.length;t++){var e=this.waterTiles[t].getBounds();this.scene.add.rectangle(e.x,e.y,e.width,e.height,10053375)}}},{key:"isPointWater",value:function(t,e){for(var a=0;a<this.waterTiles.length;a++){if(this.waterTiles[a].getBounds().contains(t+60,e+60))return this.scene.add.rectangle(t,e,2,2,16711680),!0}return this.scene.add.rectangle(t,e,6,6,65280),!1}}]),t}(),x={title:"duck-game",type:o.AUTO,scale:{mode:o.Scale.FIT},parent:"game-container",width:1600,height:1200,scene:{preload:function(){this.load.json("pond-map","assets/pond.json"),this.load.spritesheet("duck-white","assets/duck-white-spritesheet.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("duck-mallard","assets/duck-mallard-spritesheet.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("landscape-tileset","assets/landscape-spritesheet.png",{frameWidth:132,frameHeight:100}),this.load.spritesheet("water","assets/landscapeTiles_066.png",{frameWidth:132,frameHeight:100}),this.load.image("bread","assets/bread_NW.png"),this.load.image("breadc","assets/bread_cursor.png"),this.load.image("debug","assets/debug.png")},create:function(){E=new W(this),this.input.on("pointerdown",(function(t){var e=E.scene.cameras.main.getWorldPoint(t.x,t.y);T.createBread(E,e.x,e.y+40)}),this),function(){var t=E.scene.cache.json.get("pond-map"),e=t.tilewidth,a=t.tileheight;k=e/2,b=a/2;for(var i=t.layers[0].data,s=t.layers[0].width,n=t.layers[0].height,r=s*k,o=0,h=0;h<n;h++)for(var c=0;c<s;c++){var u=i[o]-1,d=(c-h)*k,l=(c+h)*b,m=void 0;53===u?(m=E.scene.add.image(r+d,32+l,"water"),E.waterTiles.push(m)):m=E.scene.add.image(r+d,32+l,"landscape-tileset",u),console.log("".concat(m.x,", ").concat(m.y," - ").concat(m.width,", ").concat(m.height)),m.depth=32+l,o++}console.log("".concat(E.waterTiles.length," water tiles."))}();for(var t=0;t<7;t++){var e=E.waterTiles[m(E.waterTiles.length)],a=w.random();E.addEntity(new F(E,e.x,e.y,a))}E.scene.cameras.main.scrollX=4550,E.scene.cameras.main.scrollY=2e3,E.scene.cameras.main.zoom=.4},update:function(){E.update(),E.pruneEntities()}},backgroundColor:"#000000"};window.addEventListener("resize",(function(){E.scene.game.scale.resize(window.innerWidth/.4,window.innerHeight/.4)}),!1),new o.Game(x);var j=function(){return s.a.createElement("div",{className:"App"},s.a.createElement("header",{className:"App-header"},s.a.createElement("div",{id:"game-container"})),"Learn ",s.a.createElement("a",{className:"App-link",href:"https://reactjs.org",target:"_blank",rel:"noopener noreferrer"},"React")," and ",s.a.createElement("a",{className:"App-link",href:"https://phaser.io/",target:"_blank",rel:"noopener noreferrer"},"Phaser"))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(j,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))},9:function(t,e,a){t.exports=a(17)}},[[9,1,2]]]);
//# sourceMappingURL=main.a4ebd44c.chunk.js.map