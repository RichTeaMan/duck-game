(this["webpackJsonpduck-game"]=this["webpackJsonpduck-game"]||[]).push([[0],{11:function(t,e,a){t.exports=a(19)},16:function(t,e,a){},17:function(t,e,a){},19:function(t,e,a){"use strict";a.r(e);var i=a(4),s=a.n(i),n=a(9),o=a.n(n),r=(a(16),a(17),a(5)),h=a(1),c=a(0),u=a(3),d=a(2),l=a(7);function m(t){return Math.floor(Math.random()*Math.floor(t))}function g(t){return t[m(t.length)]}var f=function(){function t(e,a,i,s){Object(h.a)(this,t),this.name=void 0,this.offset=void 0,this.x=void 0,this.y=void 0,this.opposite=void 0,this.name=e,this.offset=a,this.x=i,this.y=s}return Object(c.a)(t,null,[{key:"initialise",value:function(){t.west=new t("west",0,-2,0),t.northWest=new t("northWest",32,-2,-1),t.north=new t("north",64,0,-2),t.northEast=new t("northEast",96,2,-1),t.east=new t("east",128,2,0),t.southEast=new t("southEast",160,2,1),t.south=new t("south",192,0,2),t.southWest=new t("southWest",224,-2,1),t.west.opposite=t.east,t.northWest.opposite=t.southEast,t.north.opposite=t.south,t.northEast.opposite=t.southWest,t.east.opposite=t.west,t.southEast.opposite=t.northWest,t.south.opposite=t.north,t.southWest.opposite=t.northEast,t.map=[],t.map[t.west.name]=t.west,t.map[t.northWest.name]=t.northWest,t.map[t.north.name]=t.north,t.map[t.northEast.name]=t.northEast,t.map[t.east.name]=t.east,t.map[t.southEast.name]=t.southEast,t.map[t.south.name]=t.south,t.map[t.southWest.name]=t.southWest,t.list=[],t.list.push(t.west),t.list.push(t.northWest),t.list.push(t.north),t.list.push(t.northEast),t.list.push(t.east),t.list.push(t.southEast),t.list.push(t.south),t.list.push(t.southWest)}},{key:"get",value:function(e){return t.map[e]}},{key:"random",value:function(){var e=m(t.list.length);return t.list[e]}},{key:"determineFromVector",value:function(e){var a=Phaser.Math.Angle.Between(0,0,Math.abs(e.x),Math.abs(e.y)),i=[];e.x>=0&&e.y<0?i=[t.east,t.northEast,t.north]:e.x>=0&&e.y>=0?i=[t.east,t.southEast,t.south]:e.x<0&&e.y<0?i=[t.west,t.northWest,t.north]:e.x<0&&e.y>=0&&(i=[t.west,t.southWest,t.south]);var s=0;return a>1.178097?s=2:a>.3926991&&(s=1),i[s]}}]),t}();f.west=void 0,f.northWest=void 0,f.north=void 0,f.northEast=void 0,f.east=void 0,f.southEast=void 0,f.south=void 0,f.southWest=void 0,f.map=void 0,f.list=void 0,f.initialise();var v,p=function(){function t(e,a,i,s){var n=this;Object(h.a)(this,t),this.image=void 0,this.isDestroyed=!1,this.gameState=void 0,this.image=e.scene.add.image(i,s,a),this.gameState=e,this.image.on("pointerdown",(function(t){n.onPointerDown(t)}))}return Object(c.a)(t,[{key:"onPointerDown",value:function(t){}},{key:"update",value:function(){}},{key:"destroy",value:function(){this.isDestroyed=!0,this.image&&this.image.destroy()}},{key:"distanceFromEntity",value:function(t){return Phaser.Math.Distance.Between(this.x,this.y,t.x,t.y)}},{key:"vectorToEntity",value:function(t,e){return this.vectorToTarget(t.x,t.y,e)}},{key:"vectorToTarget",value:function(t,e,a){var i=t-this.x,s=e-this.y,n=Phaser.Math.Angle.Between(this.x,this.y,t,e),o=Math.cos(n),r=Math.sin(n),h=Math.abs(o)+Math.abs(r),c=o/h*a,u=r/h*a;return(c>10||u>10)&&(console.error("Spurious vectorToTargetResult - C: ".concat(t,", ").concat(e," | A: ").concat(Phaser.Math.RadToDeg(n)," | ").concat(i,", ").concat(s," | ").concat(c,", ").concat(u)),c>a?c=a:c<-a&&(c=-a),u>a?u=a:u<-a&&(u=-a)),new Phaser.Math.Vector2(c,u)}},{key:"x",get:function(){return this.image.x},set:function(t){this.image.x=t}},{key:"y",get:function(){return this.image.y},set:function(t){this.image.y=t}}]),t}();!function(t){t[t.Food=0]="Food",t[t.Duck=1]="Duck",t[t.Invisible=2]="Invisible",t[t.Nest=3]="Nest"}(v||(v={}));var y=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(t,i,s){var n;return Object(h.a)(this,a),(n=e.call(this,t,"target",i,s)).image.depth=1e4,n.image.setVisible(t.debug.showTargets),n}return Object(c.a)(a,[{key:"entityType",value:function(){return v.Invisible}},{key:"update",value:function(){}}]),a}(p),k={walk:{startFrame:0,endFrame:4,speed:.2},feed:{startFrame:5,endFrame:7,speed:.8},quack:{startFrame:8,endFrame:10,speed:.6},stand:{startFrame:11,endFrame:13,speed:.2},standFlap:{startFrame:14,endFrame:16,speed:.2}},S=function(){function t(){Object(h.a)(this,t)}return Object(c.a)(t,null,[{key:"random",value:function(){return t.duckTypes[m(t.duckTypes.length)]}}]),t}();S.duckTypes=["white","mallard"];var T=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(t,i,s,n){var o,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return Object(h.a)(this,a),(o=e.call(this,t,r?"duck-duckling":"duck-".concat(n),i,s)).name=g(["Daisy","Mavis","Harold","Ernest","Ermintrude","Annie","Reginald","Clarence","Emmett","Gert","Hilda","Doris","Hattie"]),o.motion=void 0,o.anim=void 0,o.direction=f.random(),o.speed=void 0,o.f=void 0,o.target=null,o.vector=null,o.animationStep=1,o.active=!0,o.idleTicks=0,o.thought="",o.leaderDuck=void 0,o.duckType=void 0,o.duckling=void 0,o.age=0,o.nesting=!1,o.image.scale=r?.4:.8,o.duckling=r,o.image.setInteractive({cursor:"pointer"}),o.image.input.hitArea.setTo(128,128,384,384),o.duckType=n,o.motion="walk",o.anim=k[o.motion],o.speed=o.anim.speed,o.f=o.anim.startFrame,o.gameState.scene.time.delayedCall(1e3*o.anim.speed,o.changeFrame,[],Object(l.a)(o)),o}return Object(c.a)(a,[{key:"onPointerDown",value:function(t){this.gameState.pointerHandled=!0,t.event.stopImmediatePropagation(),this.startQuackAnimation(),this.gameState.scene.sound.add("quackquack-f").play({volume:.2});var e=this.gameState.scene.cache.json.get("duck-thoughts");this.thought=g(e),this.gameState.uiScene.displayDuckInfo(this)}},{key:"entityType",value:function(){return v.Duck}},{key:"startWalkAnimation",value:function(){this.f=k.walk.startFrame,this.anim=k.walk,this.animationStep=1,this.motion="walk",this.changeFrame(),this.active=!0}},{key:"startFeedAnimation",value:function(){this.f=k.feed.startFrame,this.anim=k.feed,this.animationStep=1,this.motion="feed",this.changeFrame(),this.active=!1}},{key:"startQuackAnimation",value:function(){this.f=k.quack.startFrame,this.anim=k.quack,this.animationStep=1,this.motion="quack",this.changeFrame(),this.active=!1}},{key:"startStandAnimation",value:function(){this.f=k.stand.startFrame,this.anim=k.stand,this.animationStep=1,this.motion="stand",this.changeFrame(),this.active=!0}},{key:"startStandFlapAnimation",value:function(){this.f=k.standFlap.startFrame,this.anim=k.standFlap,this.animationStep=1,this.motion="standFlap",this.changeFrame(),this.active=!0}},{key:"changeFrame",value:function(){var t=this.anim.speed;this.image.depth=this.y+256;var e=this.f;if(this.f>this.anim.endFrame||this.f<0||this.f<this.anim.startFrame)switch(this.motion){case"walk":this.animationStep=-this.animationStep,this.f+=2*this.animationStep,e=this.f;break;case"feed":return void this.gameState.scene.time.delayedCall(1e3*t,this.startWalkAnimation,[],this);case"quack":if(e=this.f-4,11===this.f)e=9;else if(this.f>16)return void this.startWalkAnimation();this.gameState.scene.time.delayedCall(1e3*t,this.startWalkAnimation,[],this);break;case"stand":return void this.startStandFlapAnimation();case"standFlap":this.f=this.anim.startFrame,e=this.f}this.image.frame=this.image.texture.get(this.direction.offset+e),this.gameState.scene.time.delayedCall(1e3*t,this.changeFrame,[],this),this.f+=this.animationStep}},{key:"move",value:function(t,e){return!!this.gameState.isPointWater(this.x+t,this.y+e)&&(this.x+=t,this.y+=e,!0)}},{key:"sendToNest",value:function(t){var e;this.nesting=!0,null===(e=this.target)||void 0===e||e.destroy(),this.target=t,this.vector=this.vectorToEntity(t,3)}},{key:"nestingComplete",value:function(){this.nesting=!1,this.target=null,this.active=!0}},{key:"update",value:function(){var t=this;if(this.age++,this.duckling&&this.age>a.DUCKLING_MATURATION_AGE&&(this.duckling=!1,this.leaderDuck=null,this.target=null,this.image.destroy(),this.image=this.gameState.scene.add.image(this.x,this.y,"duck-".concat(this.duckType)),this.image.scale=.8,this.gameState.uiScene.displayToast("".concat(this.name," is all grown up."))),this.active){if(1===m(2e3)&&(this.gameState.scene.sound.add("quackquack-f").play({volume:.2}),this.startQuackAnimation()),null!=this.leaderDuck){var e=this.leaderDuck.direction.opposite,i=this.leaderDuck.x+90*e.x,s=this.leaderDuck.y+90*e.y;this.vector=this.vectorToTarget(i,s,1),this.direction=f.determineFromVector(this.vector)}if(null==this.target||this.target.isDestroyed||this.target.entityType()===v.Invisible){if(this.gameState.fetchFood().length>0){var n,o=this.gameState.fetchFood().map((function(e){return{distance:t.distanceFromEntity(e)+m(30),target:e}})).sort((function(t){return t.distance})).reverse()[0];if(o.distance<450)null===(n=this.target)||void 0===n||n.destroy(),this.target=o.target,this.vector=this.vectorToEntity(this.target,5),this.startStandAnimation()}if(null==this.target){var r=g(this.gameState.waterTiles);this.target=this.gameState.addEntity(new y(this.gameState,r.x,r.y)),this.vector=this.vectorToEntity(this.target,1),this.startWalkAnimation()}this.direction=f.determineFromVector(this.vector)}if(!this.nesting&&null!=this.target&&this.distanceFromEntity(this.target)<2.5)return this.target.destroy(),this.target.entityType()===v.Food&&this.startFeedAnimation(),void(this.target=null);this.nesting&&this.distanceFromEntity(this.target)<2.5&&(this.vector.x=0,this.vector.y=0,this.direction=f.west,this.active=!1),this.x+=this.vector.x,this.y+=this.vector.y,this.image.depth=this.y+this.image.y}}}]),a}(p);T.DUCKLING_MATURATION_AGE=3e3;var w=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(t,i,s,n){var o;return Object(h.a)(this,a),(o=e.call(this,t,i,s,n)).start=0,o.image.depth=n+32,o}return Object(c.a)(a,null,[{key:"createBread",value:function(t,e,i){var s=new a(t,"bread",e,i);return s.image.scale=.6,t.entities.push(s),s}}]),Object(c.a)(a,[{key:"entityType",value:function(){return v.Food}},{key:"update",value:function(){this.start++,this.start>200&&this.destroy()}}]),a}(p),b=function(){function t(){Object(h.a)(this,t),this.scene=void 0,this.uiScene=void 0,this.cursors=void 0,this.entities=[],this.waterTiles=[],this.debug={showTargets:!1,showMouseData:!0},this.pointerHandled=!1}return Object(c.a)(t,[{key:"fetchPointer",value:function(){return this.scene.input.activePointer}},{key:"fetchWorldPointerPosition",value:function(){var t=this.fetchPointer();return this.scene.cameras.main.getWorldPoint(t.x,t.y)}},{key:"update",value:function(){this.entities.forEach((function(t){t.update()})),this.pointerHandled=!1}},{key:"pruneEntities",value:function(){var t=[];this.entities.forEach((function(e){e.isDestroyed||t.push(e)})),this.entities=t}},{key:"fetchFood",value:function(){return this.entities.filter((function(t){return t.entityType()===v.Food&&!t.isDestroyed}))}},{key:"fetchDucks",value:function(){return this.entities.filter((function(t){return t.entityType()===v.Duck&&!t.isDestroyed}))}},{key:"addEntity",value:function(t){return this.entities.push(t),t}},{key:"showWaterCollision",value:function(){for(var t=0;t<this.waterTiles.length;t++){var e=this.waterTiles[t].getBounds();this.scene.add.rectangle(e.x,e.y,e.width,e.height,10053375)}}},{key:"isPointWater",value:function(t,e){for(var a=0;a<this.waterTiles.length;a++){if(this.waterTiles[a].getBounds().contains(t+60,e+60))return this.scene.add.rectangle(t,e,2,2,16711680),!0}return this.scene.add.rectangle(t,e,6,6,65280),!1}}],[{key:"singleton",value:function(){return null==t._instance&&(this._instance=new t),this._instance}}]),t}();b._instance=null;var F=a(10),E=a(6),x=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(t,i,s,n){var o;return Object(h.a)(this,a),(o=e.call(this,t,i,s,n)).nestingDuck=void 0,o.nestingTime=0,o.image.setInteractive({cursor:"pointer"}),o.image.depth=n+200,o}return Object(c.a)(a,null,[{key:"create",value:function(t,e,i){var s=new a(t,"nest",e,i);return t.addEntity(s),s}}]),Object(c.a)(a,[{key:"onPointerDown",value:function(t){if(this.gameState.pointerHandled=!0,null==this.nestingDuck){var e=this.gameState.fetchDucks().filter((function(t){return"duckling"!==t.duckType}));if(e.length>0){var a=g(e);this.nestingDuck=a,this.gameState.uiScene.displayToast("".concat(a.name," is feeling broody")),this.nestingTime=0,a.sendToNest(this)}}else this.gameState.uiScene.displayToast("A duck is already nesting there.")}},{key:"entityType",value:function(){return v.Nest}},{key:"destroy",value:function(){console.log("nest destroyed!!!"),console.trace(),Object(F.a)(Object(E.a)(a.prototype),"destroy",this).call(this)}},{key:"update",value:function(){var t=this;if(null!=this.nestingDuck&&(this.distanceFromEntity(this.nestingDuck)<2.5&&this.nestingTime++,20===this.nestingTime&&this.gameState.uiScene.displayToast("".concat(this.nestingDuck.name," has just started nesting")),this.nestingTime===Math.floor(.5*a.NESTING_DURATION)&&this.gameState.uiScene.displayToast("".concat(this.nestingDuck.name," has a while left to nest")),this.nestingTime===Math.floor(.9*a.NESTING_DURATION)&&this.gameState.uiScene.displayToast("".concat(this.nestingDuck.name," is feeling some rustling")),this.nestingTime>a.NESTING_DURATION)){this.nestingDuck.nestingComplete();for(var e=m(5)+1,i=[],s=this.nestingDuck,n=0;n<e;n++){var o=new T(this.gameState,this.nestingDuck.x,this.nestingDuck.y,S.random(),!0);o.leaderDuck=s,this.gameState.addEntity(o),s=o,i.push(o.name)}this.gameState.uiScene.displayToast("".concat(this.nestingDuck.name," brood has hatched ").concat(i.length," ducklings!")),i.forEach((function(e){t.gameState.uiScene.displayToast("Welcome ".concat(e))})),this.nestingDuck=null}}}]),a}(p);x.NESTING_DURATION=1e3;var D=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(){var t;return Object(h.a)(this,a),(t=e.call(this,"GameScene")).gameState=void 0,t}return Object(c.a)(a,[{key:"preload",value:function(){this.gameState=b.singleton(),this.gameState.scene=this;this.load.json("pond-map","assets/pond.json"),this.load.spritesheet("duck-white","assets/duck-white-spritesheet.png",{frameWidth:512,frameHeight:512}),this.load.spritesheet("duck-mallard","assets/duck-mallard-spritesheet.png",{frameWidth:512,frameHeight:512}),this.load.spritesheet("duck-duckling","assets/duck-duckling-spritesheet.png",{frameWidth:512,frameHeight:512}),this.load.spritesheet("landscape-tileset","assets/landscape-spritesheet.png",{frameWidth:132,frameHeight:100}),this.load.spritesheet("water","assets/landscapeTiles_066.png",{frameWidth:132,frameHeight:100}),this.load.image("nest","assets/pan_SE.png"),this.load.image("bread","assets/bread_NW.png"),this.load.image("breadc","assets/bread_cursor.png"),this.load.image("debug","assets/debug.png"),this.load.image("target","assets/target.png"),this.load.audio("quackquack-f","assets/quackquack-f.mp3"),this.load.json("duck-thoughts","assets/duck-thoughts.json")}},{key:"create",value:function(){window.addEventListener("resize",(function(){}),!1),this.input.setDefaultCursor("url(assets/bread_cursor.png), crosshair"),this.input.on("pointerdown",(function(t){if(!this.gameState.pointerHandled&&t.leftButtonDown()){this.gameState;var e=this.gameState.scene.cameras.main.getWorldPoint(t.x,t.y);w.createBread(this.gameState,e.x,e.y+40)}}),this),this.buildMap();for(var t=0;t<7;t++){var e=this.gameState.waterTiles[m(this.gameState.waterTiles.length)],a=S.random();this.gameState.addEntity(new T(this.gameState,e.x,e.y,a))}x.create(this.gameState,7013,2144),this.gameState.scene.cameras.main.scrollX=4550,this.gameState.scene.cameras.main.scrollY=2e3,this.gameState.scene.cameras.main.zoom=.4}},{key:"update",value:function(){this.gameState.update(),this.gameState.pruneEntities()}},{key:"buildMap",value:function(){for(var t=this.gameState.scene.cache.json.get("pond-map"),e=t.tilewidth/2,a=t.tileheight/2,i=t.layers[0].data,s=t.layers[0].width,n=t.layers[0].height,o=s*e,r=0,h=0;h<n;h++)for(var c=0;c<s;c++){var u=i[r]-1,d=(c-h)*e,l=(c+h)*a,m=void 0;53===u?(m=this.gameState.scene.add.image(o+d,32+l,"water"),this.gameState.waterTiles.push(m)):m=this.gameState.scene.add.image(o+d,32+l,"landscape-tileset",u),m.depth=32+l,r++}}}]),a}(r.Scene),j='Perpetua , Georgia, "Goudy Bookletter 1911", Times, serif',O=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(){var t;return Object(h.a)(this,a),(t=e.call(this,{key:"UiScene",active:!0})).gameState=void 0,t.duckInfoObjects=[],t.debugMessage=void 0,t.toastMessages=[],t.toastX=50,t.toastY=400,t.toastYMargin=15,t}return Object(c.a)(a,[{key:"preload",value:function(){this.gameState=b.singleton(),this.gameState.uiScene=this,this.debugMessage=this.addText("")}},{key:"create",value:function(){this.startBeginningMessage()}},{key:"update",value:function(){var t="";if(this.gameState.debug.showMouseData){var e=this.gameState.fetchPointer(),a=this.gameState.fetchWorldPointerPosition();t+="Mouse: (".concat(e.x.toFixed(2),", ").concat(e.y.toFixed(2),") World: (").concat(a.x.toFixed(2),", ").concat(a.y.toFixed(2),")")}""!==t&&(this.debugMessage.text=t)}},{key:"startBeginningMessage",value:function(){var t=this.addText("Hello. This is your pond.",6);t.x=this.findMiddleWidth(t),t.y=this.cameras.main.height/4,t.alpha=0;var e=this.addText("Try feeding a duck. Press on the water.",4);e.x=this.findMiddleWidth(e),e.y=this.cameras.main.height/4,e.alpha=0;var a=this.tweens.timeline();a.add({targets:t,duration:2e3,alpha:1}).add({targets:t,duration:4e3}).add({targets:t,duration:2e3,alpha:0}).add({targets:t,duration:2e3,alpha:0}).add({targets:e,duration:2e3,alpha:1}).add({targets:e,duration:4e3}).add({targets:e,duration:2e3,alpha:0}),a.play()}},{key:"addText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=this.add.text(0,0,t,{fontFamily:j,fontSize:"".concat(e,"em")});return a}},{key:"addTextWithDuration",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=this.addText(t,a);return this.time.delayedCall(1e3*e,(function(){i.destroy()}),null,null),i}},{key:"displayDuckInfo",value:function(t){this.duckInfoObjects.forEach((function(t){t.destroy()}));var e=this.addText(t.name,4),a=this.add.text(0,0,t.duckling?"(a duck in training)":"(the duck)",{fontFamily:j,fontSize:"2em",fontStyle:"italic"}),i=this.add.text(0,0,"is thinking about ".concat(t.thought),{fontFamily:j,fontSize:"2em",fontStyle:"italic"});e.x=40,e.y=.75*this.cameras.main.height,a.y=e.y+e.height-1.25*a.height,a.x=e.x+e.width+20,i.x=80,i.y=e.y+40,this.duckInfoObjects=[e,a,i]}},{key:"displayToast",value:function(t){var e=this,a=this.addText(t);this.time.delayedCall(15e3,(function(){e.toastMessages=e.toastMessages.filter((function(t){return t!==a})),a.destroy(),e.repositionToasts()}),null,null),this.toastMessages.push(a),this.repositionToasts()}},{key:"repositionToasts",value:function(){var t=this,e=this.toastY;this.toastMessages.forEach((function(a){e>.75*t.cameras.main.height?a.setVisible(!1):(a.setVisible(!0),a.y=e,a.x=t.toastX,e+=t.toastYMargin+a.height)}))}},{key:"findMiddleWidth",value:function(t){return this.cameras.main.width/2-t.width/2}}]),a}(r.Scene),W={title:"duck-game",type:r.AUTO,scale:{mode:r.Scale.FIT},parent:"game-container",width:1600,height:1200,scene:[D,O],backgroundColor:"#000000"};window.addEventListener("resize",(function(){}),!1),new r.Game(W);var M=function(){return s.a.createElement("div",{className:"App"},s.a.createElement("header",{className:"App-header"},s.a.createElement("div",{id:"game-container"})),"Learn ",s.a.createElement("a",{className:"App-link",href:"https://reactjs.org",target:"_blank",rel:"noopener noreferrer"},"React")," and ",s.a.createElement("a",{className:"App-link",href:"https://phaser.io/",target:"_blank",rel:"noopener noreferrer"},"Phaser"))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(M,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[11,1,2]]]);
//# sourceMappingURL=main.a8418109.chunk.js.map