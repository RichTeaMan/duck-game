{"version":3,"sources":["game/utils.ts","game/direction.ts","game/entity.ts","game/entityType.ts","game/invisibleTarget.ts","game/duck.ts","game/food.ts","game/gameState.ts","game/nest.ts","game/gameScene.ts","game/uiScene.ts","game/gameRunner.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["randomInt","max","Math","floor","random","randomElement","array","length","Direction","name","offset","x","y","opposite","this","west","northWest","north","northEast","east","southEast","south","southWest","map","list","push","i","vector","angle","Phaser","Angle","Between","abs","quad","initialise","EntityType","Entity","gameState","imageName","image","isDestroyed","scene","add","on","pointer","onPointerDown","destroy","otherEntity","Distance","entity","speed","vectorToTarget","dx","dy","xR","cos","yR","sin","total","modX","modY","console","error","RadToDeg","Vector2","InvisibleTarget","depth","setVisible","debug","showTargets","Invisible","duckAnims","walk","startFrame","endFrame","feed","quack","stand","standFlap","DuckType","duckTypes","Duck","duckType","duckling","fetchName","motion","anim","direction","f","target","animationStep","active","idleTicks","thought","leaderDuck","lastNested","DUCKLING_MATURATION_AGE","age","nesting","scale","setInteractive","cursor","input","hitArea","setTo","time","delayedCall","changeFrame","pointerHandled","event","stopImmediatePropagation","startQuackAnimation","fetchThought","uiScene","displayDuckInfo","cache","json","get","duckNames","ducklingThoughts","duckThoughts","delay","localF","startWalkAnimation","startStandFlapAnimation","frame","texture","isPointWater","nest","vectorToEntity","determineFromVector","ticks","quackTrack","CHIRPS","QUACKS","sound","play","volume","displayToast","oppDir","justBehindX","justBehindY","entityType","fetchFood","select","distance","distanceFromEntity","sort","reverse","startStandAnimation","waterTile","waterTiles","addEntity","Food","startFeedAnimation","start","bread","entities","GameState","cursors","showMouseData","showResolutionData","showUiResolutionData","cameraPanning","activePointer","fetchPointer","cameras","main","getWorldPoint","forEach","update","newEntities","filter","e","r","getBounds","rectangle","width","height","contains","_instance","Nest","nestingDuck","nestingTime","ducks","fetchDucks","duck","log","sendToNest","trace","NESTING_DURATION","nestingComplete","ducklingCount","names","leader","GameScene","singleton","load","spritesheet","frameWidth","frameHeight","audio","keyboard","createCursorKeys","setDefaultCursor","leftButtonDown","point","createBread","buildMap","randomTile","randomDuckType","create","scrollX","scrollY","zoom","resize","loop","gameSize","baseSize","displaySize","resolution","x2","TARGET_WIDTH","pruneEntities","left","isDown","right","up","down","data","tileWidthHalf","tilewidth","tileHeightHalf","tileheight","layer","layers","mapWidth","mapHeight","centerX","id","tx","ty","tile","FONT_FAMILY","UiScene","key","duckInfoObjects","debugMessage","toastMessages","toastX","toastY","toastYMargin","previousHeight","previousWidth","addText","startBeginningMessage","children","getAll","child","ui","ratioX","ratioY","debugMsg","worldPointer","fetchWorldPointerPosition","toFixed","camera","text","helloMessage","findMiddleWidth","alpha","foodMessage","nestMessage","timeLine","tweens","timeline","targets","duration","size","textObject","fontFamily","fontSize","seconds","titleMsg","element","s","charAt","toUpperCase","slice","title","fontStyle","message","toast","t","repositionToasts","toastMessage","object","gameConfig","type","mode","RESIZE","parent","backgroundColor","App","className","href","rel","Boolean","window","location","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"8RAAO,SAASA,EAAUC,GACtB,OAAOC,KAAKC,MAAMD,KAAKE,SAAWF,KAAKC,MAAMF,IAG1C,SAASI,EAAiBC,GAE7B,OAAOA,EADGN,EAAUM,EAAMC,SCHvB,IAAMC,EAAb,WA2GI,WAAYC,EAAcC,EAAgBC,EAAWC,GAAY,yBANjEH,UAMgE,OALhEC,YAKgE,OAJhEC,OAIgE,OAHhEC,OAGgE,OAFhEC,cAEgE,EAC5DC,KAAKL,KAAOA,EACZK,KAAKJ,OAASA,EACdI,KAAKH,EAAIA,EACTG,KAAKF,EAAIA,EA/GjB,8DAgBQJ,EAAUO,KAAO,IAAIP,EAAU,OAAQ,GAAI,EAAG,GAC9CA,EAAUQ,UAAY,IAAIR,EAAU,YAAa,IAAK,GAAI,GAC1DA,EAAUS,MAAQ,IAAIT,EAAU,QAAS,GAAI,GAAI,GACjDA,EAAUU,UAAY,IAAIV,EAAU,YAAa,GAAI,GAAI,GACzDA,EAAUW,KAAO,IAAIX,EAAU,OAAQ,IAAK,EAAG,GAC/CA,EAAUY,UAAY,IAAIZ,EAAU,YAAa,IAAK,EAAG,GACzDA,EAAUa,MAAQ,IAAIb,EAAU,QAAS,IAAK,EAAG,GACjDA,EAAUc,UAAY,IAAId,EAAU,YAAa,KAAM,EAAG,GAE1DA,EAAUO,KAAKF,SAAWL,EAAUW,KACpCX,EAAUQ,UAAUH,SAAWL,EAAUY,UACzCZ,EAAUS,MAAMJ,SAAWL,EAAUa,MACrCb,EAAUU,UAAUL,SAAWL,EAAUc,UACzCd,EAAUW,KAAKN,SAAWL,EAAUO,KACpCP,EAAUY,UAAUP,SAAWL,EAAUQ,UACzCR,EAAUa,MAAMR,SAAWL,EAAUS,MACrCT,EAAUc,UAAUT,SAAWL,EAAUU,UAEzCV,EAAUe,IAAM,GAChBf,EAAUe,IAAIf,EAAUO,KAAKN,MAAQD,EAAUO,KAC/CP,EAAUe,IAAIf,EAAUQ,UAAUP,MAAQD,EAAUQ,UACpDR,EAAUe,IAAIf,EAAUS,MAAMR,MAAQD,EAAUS,MAChDT,EAAUe,IAAIf,EAAUU,UAAUT,MAAQD,EAAUU,UACpDV,EAAUe,IAAIf,EAAUW,KAAKV,MAAQD,EAAUW,KAC/CX,EAAUe,IAAIf,EAAUY,UAAUX,MAAQD,EAAUY,UACpDZ,EAAUe,IAAIf,EAAUa,MAAMZ,MAAQD,EAAUa,MAChDb,EAAUe,IAAIf,EAAUc,UAAUb,MAAQD,EAAUc,UAEpDd,EAAUgB,KAAO,GACjBhB,EAAUgB,KAAKC,KAAKjB,EAAUO,MAC9BP,EAAUgB,KAAKC,KAAKjB,EAAUQ,WAC9BR,EAAUgB,KAAKC,KAAKjB,EAAUS,OAC9BT,EAAUgB,KAAKC,KAAKjB,EAAUU,WAC9BV,EAAUgB,KAAKC,KAAKjB,EAAUW,MAC9BX,EAAUgB,KAAKC,KAAKjB,EAAUY,WAC9BZ,EAAUgB,KAAKC,KAAKjB,EAAUa,OAC9Bb,EAAUgB,KAAKC,KAAKjB,EAAUc,aApDtC,0BAuDeb,GACP,OAAOD,EAAUe,IAAId,KAxD7B,+BA4DQ,IAAMiB,EAAI1B,EAAUQ,EAAUgB,KAAKjB,QACnC,OAAOC,EAAUgB,KAAKE,KA7D9B,0CAgE+BC,GAEvB,IAAMC,EAAQC,OAAO3B,KAAK4B,MAAMC,QAAQ,EAAG,EAAG7B,KAAK8B,IAAIL,EAAOhB,GAAIT,KAAK8B,IAAIL,EAAOf,IAE9EqB,EAAO,GAKPN,EAAOhB,GAAK,GAAKgB,EAAOf,EAAI,EAC5BqB,EAAO,CAACzB,EAAUW,KAAMX,EAAUU,UAAWV,EAAUS,OAGlDU,EAAOhB,GAAK,GAAKgB,EAAOf,GAAK,EAClCqB,EAAO,CAACzB,EAAUW,KAAMX,EAAUY,UAAWZ,EAAUa,OAGlDM,EAAOhB,EAAI,GAAKgB,EAAOf,EAAI,EAChCqB,EAAO,CAACzB,EAAUO,KAAMP,EAAUQ,UAAWR,EAAUS,OAGlDU,EAAOhB,EAAI,GAAKgB,EAAOf,GAAK,IACjCqB,EAAO,CAACzB,EAAUO,KAAMP,EAAUc,UAAWd,EAAUa,QAG3D,IAAIK,EAAI,EASR,OARIE,EAAQ,SACRF,EAAI,EAECE,EAAQ,WACbF,EAAI,GAGUO,EAAKP,OAjG/B,KAAalB,EAEFO,U,EAFEP,EAGFQ,e,EAHER,EAIFS,W,EAJET,EAKFU,e,EALEV,EAMFW,U,EANEX,EAOFY,e,EAPEZ,EAQFa,W,EAREb,EASFc,e,EATEd,EAWFe,S,EAXEf,EAYFgB,U,EAsGXhB,EAAU0B,aCjHH,ICHKC,EDGUC,EAAtB,WAMI,WAAYC,EAAsBC,EAAmB3B,EAAWC,GAAY,IAAD,gCAJ3E2B,WAI2E,OAH3EC,aAAc,EAG6D,KAF3EH,eAE2E,EACvEvB,KAAKyB,MAAQF,EAAUI,MAAMC,IAAIH,MAAM5B,EAAGC,EAAG0B,GAC7CxB,KAAKuB,UAAYA,EAEjBvB,KAAKyB,MAAMI,GAAG,eAAe,SAACC,GAC1B,EAAKC,cAAcD,MAX/B,0DAiBkBA,MAjBlB,kEA0BQ9B,KAAK0B,aAAc,EACf1B,KAAKyB,OACLzB,KAAKyB,MAAMO,YA5BvB,yCA+BuBC,GACf,OAAOlB,OAAO3B,KAAK8C,SAASjB,QAAQjB,KAAKH,EAAGG,KAAKF,EAAGmC,EAAYpC,EAAGoC,EAAYnC,KAhCvF,qCAmCmBqC,EAAgBC,GAC3B,OAAOpC,KAAKqC,eAAeF,EAAOtC,EAAGsC,EAAOrC,EAAGsC,KApCvD,qCAuCmBvC,EAAWC,EAAWsC,GAEjC,IAAME,EAAKzC,EAAIG,KAAKH,EACd0C,EAAKzC,EAAIE,KAAKF,EAEdgB,EAAQC,OAAO3B,KAAK4B,MAAMC,QAAQjB,KAAKH,EAAGG,KAAKF,EAAGD,EAAGC,GACvD0C,EAAKpD,KAAKqD,IAAI3B,GACd4B,EAAKtD,KAAKuD,IAAI7B,GAEZ8B,EAASxD,KAAK8B,IAAIsB,GAAMpD,KAAK8B,IAAIwB,GACnCG,EAAQL,EAAKI,EAASR,EACtBU,EAAQJ,EAAKE,EAASR,EAoB1B,OAlBIS,EAAO,IAAMC,EAAO,MAEpBC,QAAQC,MAAR,6CAAoDnD,EAApD,aAA0DC,EAA1D,iBAAoEiB,OAAO3B,KAAK6D,SAASnC,GAAzF,cAAqGwB,EAArG,aAA4GC,EAA5G,cAAoHM,EAApH,aAA6HC,IAEzHD,EAAOT,EACPS,EAAOT,EAEFS,GAAQT,IACbS,GAAQT,GAGRU,EAAOV,EACPU,EAAOV,EAEFU,GAAQV,IACbU,GAAQV,IAGT,IAAIrB,OAAO3B,KAAK8D,QAAQL,EAAMC,KAtE7C,wBA0EQ,OAAO9C,KAAKyB,MAAM5B,GA1E1B,aA4EUA,GACFG,KAAKyB,MAAM5B,EAAIA,IA7EvB,wBAiFQ,OAAOG,KAAKyB,MAAM3B,GAjF1B,aAmFUA,GACFE,KAAKyB,MAAM3B,EAAIA,MApFvB,M,SCHYuB,O,eAAAA,I,eAAAA,I,yBAAAA,I,gBAAAA,M,KCIL,IAAM8B,EAAb,kDAEI,WAAY5B,EAAsB1B,EAAWC,GAAY,IAAD,8BACpD,cAAMyB,EAAW,SAAU1B,EAAGC,IAEzB2B,MAAM2B,MAAQ,IACnB,EAAK3B,MAAM4B,WAAW9B,EAAU+B,MAAMC,aAJc,EAF5D,yDAUQ,OAAOlC,EAAWmC,YAV1B,uCAAqClC,GCI/BmC,EAAY,CACdC,KAAM,CACFC,WAAY,EACZC,SAAU,EACVxB,MAAO,IAEXyB,KAAM,CACFF,WAAY,EACZC,SAAU,EACVxB,MAAO,IAEX0B,MAAO,CACHH,WAAY,EACZC,SAAU,GACVxB,MAAO,IAEX2B,MAAO,CACHJ,WAAY,GACZC,SAAU,GACVxB,MAAO,IAEX4B,UAAW,CACPL,WAAY,GACZC,SAAU,GACVxB,MAAO,KAIF6B,EAAb,sGASQ,OAAOA,EAASC,UAAUhF,EAAU+E,EAASC,UAAUzE,aAT/D,KAAawE,EACFC,UAAY,CACf,QACA,UACA,QACA,YAQD,IAAMC,EAAb,kDAgEI,WAAY5C,EAAsB1B,EAAWC,EAAWsE,GAAqC,IAAD,EAAlBC,EAAkB,oFACxF,cAAM9C,EAAW8C,EAAQ,+BAA6BD,GAAYvE,EAAGC,IA1CzEH,KAAO,EAAK2E,YAyCgF,EAvC5FC,YAuC4F,IAtC5FC,UAsC4F,IArC5FC,UAAuB/E,EAAUJ,SAqC2D,EApC5F8C,WAoC4F,IA/B5FsC,OA+B4F,IA7B5FC,OAAiB,KA6B2E,EA5B5F9D,OAA8B,KA4B8D,EA1B5F+D,cAAgB,EA0B4E,EAxB5FC,QAAS,EAwBmF,EAtB5FC,UAAY,EAsBgF,EApB5FC,QAAkB,GAoB0E,EAf5FC,gBAe4F,IAb5FZ,cAa4F,IAX5FC,cAW4F,IAT5FY,YAAe,GAAKd,EAAKe,wBASmE,EAJ5FC,IAAM,EAIsF,EAFpFC,SAAU,EAKV,EAAK3D,MAAM4D,MADXhB,EACmB,GAGA,GAGvB,EAAKA,SAAWA,EAEhB,EAAK5C,MAAM6D,eAAe,CAAEC,OAAQ,YACpC,EAAK9D,MAAM+D,MAAMC,QAAQC,MAAM,IAAK,IAAK,IAAW,KAEpD,EAAKtB,SAAWA,EAChB,EAAKG,OAAS,OACd,EAAKC,KAAOf,EAAU,EAAKc,QAC3B,EAAKnC,MAAQ,EAAKoC,KAAKpC,MACvB,EAAKsC,EAAI,EAAKF,KAAKb,WAEnB,EAAKpC,UAAUI,MAAMgE,KAAKC,YAA8B,IAAlB,EAAKpB,KAAKpC,MAAc,EAAKyD,YAAa,GAAhF,gBApBwF,EAhEhG,0DAuFkB/D,GACV9B,KAAKuB,UAAUuE,gBAAiB,EAChChE,EAAQiE,MAAMC,2BACdhG,KAAKiG,sBACLjG,KAAK8D,QACL9D,KAAK+E,QAAU/E,KAAKkG,eACpBlG,KAAKuB,UAAU4E,QAAQC,gBAAgBpG,QA7F/C,mCAiGQ,OAAOqB,EAAW8C,OAjG1B,kCAsGQ,OAAO5E,EADOS,KAAKuB,UAAUI,MAAM0E,MAAMC,KAAKC,IAAI,aAAaC,aArGvE,qCAiHQ,OAAOjH,EANHS,KAAKqE,SACMrE,KAAKuB,UAAUI,MAAM0E,MAAMC,KAAKC,IAAI,aAAaE,iBAGjDzG,KAAKuB,UAAUI,MAAM0E,MAAMC,KAAKC,IAAI,aAAaG,gBA/GxE,2CAqHQ1G,KAAK0E,EAAIjB,EAAS,KAASE,WAC3B3D,KAAKwE,KAAOf,EAAS,KACrBzD,KAAK4E,cAAgB,EACrB5E,KAAKuE,OAAS,OACdvE,KAAK6F,cACL7F,KAAK6E,QAAS,IA1HtB,2CA8HQ7E,KAAK0E,EAAIjB,EAAS,KAASE,WAC3B3D,KAAKwE,KAAOf,EAAS,KACrBzD,KAAK4E,cAAgB,EACrB5E,KAAKuE,OAAS,OACdvE,KAAK6F,cACL7F,KAAK6E,QAAS,IAnItB,4CAuIQ7E,KAAK0E,EAAIjB,EAAS,MAAUE,WAC5B3D,KAAKwE,KAAOf,EAAS,MACrBzD,KAAK4E,cAAgB,EACrB5E,KAAKuE,OAAS,QACdvE,KAAK6F,cACL7F,KAAK6E,QAAS,IA5ItB,4CAgJQ7E,KAAK0E,EAAIjB,EAAS,MAAUE,WAC5B3D,KAAKwE,KAAOf,EAAS,MACrBzD,KAAK4E,cAAgB,EACrB5E,KAAKuE,OAAS,QACdvE,KAAK6F,cACL7F,KAAK6E,QAAS,IArJtB,gDAyJQ7E,KAAK0E,EAAIjB,EAAS,UAAcE,WAChC3D,KAAKwE,KAAOf,EAAS,UACrBzD,KAAK4E,cAAgB,EACrB5E,KAAKuE,OAAS,YACdvE,KAAK6F,cACL7F,KAAK6E,QAAS,IA9JtB,oCAmKQ,IAAI8B,EAAQ3G,KAAKwE,KAAKpC,MACtBpC,KAAKyB,MAAM2B,MAAQpD,KAAKF,EAAI,IAC5B,IAAI8G,EAAS5G,KAAK0E,EAElB,GAAI1E,KAAK0E,EAAI1E,KAAKwE,KAAKZ,UAAY5D,KAAK0E,EAAI,GAAK1E,KAAK0E,EAAI1E,KAAKwE,KAAKb,WAChE,OAAQ3D,KAAKuE,QACT,IAAK,OACDvE,KAAK4E,eAAiB5E,KAAK4E,cAC3B5E,KAAK0E,GAAK,EAAI1E,KAAK4E,cACnBgC,EAAS5G,KAAK0E,EACd,MAEJ,IAAK,OAED,YADA1E,KAAKuB,UAAUI,MAAMgE,KAAKC,YAAoB,IAARe,EAAc3G,KAAK6G,mBAAoB,GAAI7G,MAGrF,IAAK,QAED,GADA4G,EAAS5G,KAAK0E,EAAI,EACH,KAAX1E,KAAK0E,EACLkC,EAAS,OAER,GAAI5G,KAAK0E,EAAI,GAEd,YADA1E,KAAK6G,qBAGT7G,KAAKuB,UAAUI,MAAMgE,KAAKC,YAAoB,IAARe,EAAc3G,KAAK6G,mBAAoB,GAAI7G,MACjF,MAEJ,IAAK,QAED,YADAA,KAAK8G,0BAET,IAAK,YACD9G,KAAK0E,EAAI1E,KAAKwE,KAAKb,WACnBiD,EAAS5G,KAAK0E,EAK1B1E,KAAKyB,MAAMsF,MAAQ/G,KAAKyB,MAAMuF,QAAQT,IAAIvG,KAAKyE,UAAU7E,OAASgH,GAClE5G,KAAKuB,UAAUI,MAAMgE,KAAKC,YAAoB,IAARe,EAAc3G,KAAK6F,YAAa,GAAI7F,MAC1EA,KAAK0E,GAAK1E,KAAK4E,gBA3MvB,2BAmNS/B,EAAcC,GAEf,QAAI9C,KAAKuB,UAAU0F,aAAajH,KAAKH,EAAIgD,EAAM7C,KAAKF,EAAIgD,KACpD9C,KAAKH,GAAKgD,EACV7C,KAAKF,GAAKgD,GACH,KAxNnB,iCA6NeoE,GAAa,IAAD,EAEnBlH,KAAKoF,SAAU,EACf,UAAApF,KAAK2E,cAAL,SAAa3C,UACbhC,KAAK2E,OAASuC,EACdlH,KAAKa,OAASb,KAAKmH,eAAeD,EAAM,GACxClH,KAAKyE,UAAY/E,EAAU0H,oBAAoBpH,KAAKa,UAnO5D,wCAuOQb,KAAKoF,SAAU,EACfpF,KAAK2E,OAAS,KACd3E,KAAK6E,QAAS,EACd7E,KAAKiF,WAAajF,KAAKuB,UAAU8F,QA1OzC,8BA8OQ,IAAIC,EAEAA,EADAtH,KAAKqE,SACQ9E,EAAc4E,EAAKoD,QAGnBhI,EAAc4E,EAAKqD,QAEpCxH,KAAKuB,UAAUI,MAAM8F,MAAM7F,IAAI0F,GAAYI,KAAK,CAAEC,OAAQ,OArPlE,+BAwPc,IAAD,OAeL,GAdA3H,KAAKmF,MACDnF,KAAKqE,UAAYrE,KAAKmF,IAAMhB,EAAKe,0BAEjClF,KAAKqE,UAAW,EAChBrE,KAAKgF,WAAa,KAClBhF,KAAK2E,OAAS,KACd3E,KAAKyB,MAAMO,UAEXhC,KAAKyB,MAAQzB,KAAKuB,UAAUI,MAAMC,IAAIH,MAAMzB,KAAKH,EAAGG,KAAKF,EAA5C,eAAuDE,KAAKoE,WACzEpE,KAAKyB,MAAM4D,MAAQ,GAEnBrF,KAAKuB,UAAU4E,QAAQyB,aAAvB,UAAuC5H,KAAKL,KAA5C,uBAGCK,KAAK6E,OAAV,CASA,GALwB,IAApB3F,EAAU,OACVc,KAAK8D,QACL9D,KAAKiG,uBAGc,MAAnBjG,KAAKgF,WAAoB,CACzB,IAAM6C,EAAS7H,KAAKgF,WAAWP,UAAU1E,SAGnC+H,EAAc9H,KAAKgF,WAAWnF,EADf,GACkCgI,EAAOhI,EACxDkI,EAAc/H,KAAKgF,WAAWlF,EAFf,GAEkC+H,EAAO/H,EAE9DE,KAAKa,OAASb,KAAKqC,eAAeyF,EAAaC,EAAa,GAC5D/H,KAAKyE,UAAY/E,EAAU0H,oBAAoBpH,KAAKa,QAIxD,GAAmB,MAAfb,KAAK2E,QAAkB3E,KAAK2E,OAAOjD,aAAe1B,KAAK2E,OAAOqD,eAAiB3G,EAAWmC,UAAW,CAGrG,GAAIxD,KAAKuB,UAAU0G,YAAYxI,OAAS,EAAG,CACvC,IAE2B,EADrByI,EADYlI,KAAKuB,UAAU0G,YAAYxH,KAAI,SAAAiE,GAAC,MAAK,CAAEyD,SAAU,EAAKC,mBAAmB1D,GAAKxF,EAAU,IAAKyF,OAAQD,MAC9F2D,MAAK,SAAA3D,GAAC,OAAIA,EAAEyD,YAAUG,UAAU,GACzD,GAAIJ,EAAOC,SAAW,IAElB,UAAAnI,KAAK2E,cAAL,SAAa3C,UACbhC,KAAK2E,OAASuD,EAAOvD,OACrB3E,KAAKa,OAASb,KAAKmH,eAAenH,KAAK2E,OAAQ,GAC/C3E,KAAKuI,sBAKb,GAAmB,MAAfvI,KAAK2E,OAAgB,CAErB,IAAM6D,EAAYjJ,EAAcS,KAAKuB,UAAUkH,YAC/CzI,KAAK2E,OAAS3E,KAAKuB,UAAUmH,UAAU,IAAIvF,EAAgBnD,KAAKuB,UAAWiH,EAAU3I,EAAG2I,EAAU1I,IAElGE,KAAKa,OAASb,KAAKmH,eAAenH,KAAK2E,OAAQ,GAC/C3E,KAAK6G,qBAET7G,KAAKyE,UAAY/E,EAAU0H,oBAAoBpH,KAAKa,QAGxD,IAAKb,KAAKoF,SAA0B,MAAfpF,KAAK2E,QAAkB3E,KAAKoI,mBAAmBpI,KAAK2E,QAAU,IAO/E,OANA3E,KAAK2E,OAAO3C,UAERhC,KAAK2E,OAAOqD,eAAiB3G,EAAWsH,MACxC3I,KAAK4I,0BAET5I,KAAK2E,OAAS,MAGd3E,KAAKoF,SAAWpF,KAAKoI,mBAAmBpI,KAAK2E,QAAU,MACvD3E,KAAKa,OAAOhB,EAAI,EAChBG,KAAKa,OAAOf,EAAI,EAChBE,KAAKyE,UAAY/E,EAAUO,KAC3BD,KAAK6E,QAAS,GAGlB7E,KAAKH,GAAKG,KAAKa,OAAOhB,EACtBG,KAAKF,GAAKE,KAAKa,OAAOf,EACtBE,KAAKyB,MAAM2B,MAAQpD,KAAKF,EAAIE,KAAKyB,MAAM3B,OAzU/C,GAA0BwB,GAAb6C,EAEFqD,OAAS,CACZ,WACA,gBACA,WACA,gBACA,WACA,iBARKrD,EAWFoD,OAAS,CACZ,SACA,cACA,SACA,eAfKpD,EAqBFe,wBAA0B,IClE9B,IAAMyD,EAAb,kDAYI,WAAYpH,EAAsBC,EAAmB3B,EAAWC,GAAY,IAAD,8BACvE,cAAMyB,EAAWC,EAAW3B,EAAGC,IAHnC+I,MAAQ,EAKJ,EAAKpH,MAAM2B,MAAQtD,EAAI,GAHgD,EAZ/E,6DAEuByB,EAAsB1B,EAAWC,GAEhD,IAAMgJ,EAAQ,IAAIH,EAAKpH,EAAW,QAAS1B,EAAGC,GAG9C,OAFAgJ,EAAMrH,MAAM4D,MAAQ,GACpB9D,EAAUwH,SAASpI,KAAKmI,GACjBA,MAPf,kDAmBQ,OAAOzH,EAAWsH,OAnB1B,+BAuBQ3I,KAAK6I,QAED7I,KAAK6I,MAAQ,KACb7I,KAAKgC,cA1BjB,GAA0BV,GCGb0H,EAAb,iDAUIrH,WAVJ,OAWIwE,aAXJ,OAYI8C,aAZJ,OAaIF,SAA0B,GAb9B,KAcIN,WAA8C,GAdlD,KAeIpB,MAAQ,EAfZ,KAiBI/D,MAAQ,CACJC,aAAa,EACb2F,eAAe,EACfC,oBAAoB,EACpBC,sBAAsB,EACtBC,eAAe,GAtBvB,KAyBIvD,gBAAiB,EAzBrB,2DA4BQ,OAAO9F,KAAK2B,MAAM6D,MAAM8D,gBA5BhC,kDAgCQ,IAAMxH,EAAU9B,KAAKuJ,eAErB,OADcvJ,KAAK2B,MAAM6H,QAAQC,KAAKC,cAAc5H,EAAQjC,EAAGiC,EAAQhC,KAjC/E,+BAsCQE,KAAK+I,SAASY,SAAQ,SAAAxH,GAClBA,EAAOyH,YAGX5J,KAAK8F,gBAAiB,EACtB9F,KAAKqH,UA3Cb,sCAgDQ,IAAMwC,EAA6B,GACnC7J,KAAK+I,SAASY,SAAQ,SAAAxH,GACbA,EAAOT,aACRmI,EAAYlJ,KAAKwB,MAGzBnC,KAAK+I,SAAWc,IAtDxB,kCA0DQ,OAAO7J,KAAK+I,SAASe,QAAO,SAAAC,GAAC,OAAIA,EAAE/B,eAAiB3G,EAAWsH,OAASoB,EAAErI,iBA1DlF,mCA8DQ,OAAO1B,KAAK+I,SAASe,QAAO,SAAAC,GAAC,OAAIA,EAAE/B,eAAiB3G,EAAW8C,OAAS4F,EAAErI,iBA9DlF,gCAiEcS,GAGN,OADAnC,KAAK+I,SAASpI,KAAKwB,GACZA,IApEf,2CAwEQ,IAAK,IAAIvB,EAAI,EAAGA,EAAIZ,KAAKyI,WAAWhJ,OAAQmB,IAAK,CAC7C,IACMoJ,EADOhK,KAAKyI,WAAW7H,GACdqJ,YACfjK,KAAK2B,MAAMC,IAAIsI,UAAUF,EAAEnK,EAAGmK,EAAElK,EAAGkK,EAAEG,MAAOH,EAAEI,OAAQ,aA3ElE,mCA+EiBvK,EAAWC,GAEpB,IAAK,IAAIc,EAAI,EAAGA,EAAIZ,KAAKyI,WAAWhJ,OAAQmB,IAAK,CAE7C,GADaZ,KAAKyI,WAAW7H,GACpBqJ,YAAYI,SAASxK,EAAI,GAAIC,EAAI,IAEtC,OADAE,KAAK2B,MAAMC,IAAIsI,UAAUrK,EAAGC,EAAG,EAAG,EAAG,WAC9B,EAIf,OADAE,KAAK2B,MAAMC,IAAIsI,UAAUrK,EAAGC,EAAG,EAAG,EAAG,QAC9B,KAzFf,mCAOQ,OAH2B,MAAvBkJ,EAAUsB,YACVtK,KAAKsK,UAAY,IAAItB,GAElBhJ,KAAKsK,cAPpB,KAAatB,EAEMsB,UAAY,K,mBCHlBC,EAAb,kDAqBI,WAAYhJ,EAAsBC,EAAmB3B,EAAWC,GAAY,IAAD,8BACvE,cAAMyB,EAAWC,EAAW3B,EAAGC,IAR3B0K,iBAOmE,IAFnEC,YAAc,EAKlB,EAAKhJ,MAAM6D,eAAe,CAAEC,OAAQ,YACpC,EAAK9D,MAAM2B,MAAQtD,EAAI,IACvB,EAAK2B,MAAM4D,MAAQ,GALoD,EArB/E,wDAOkB9D,EAAsB1B,EAAWC,GAE3C,IAAMoH,EAAO,IAAIqD,EAAKhJ,EAAW,OAAQ1B,EAAGC,GAE5C,OADAyB,EAAUmH,UAAUxB,GACbA,MAXf,mDA6BkBpF,GAAgC,IAAD,OAGzC,GAFA9B,KAAKuB,UAAUuE,gBAAiB,EAER,MAApB9F,KAAKwK,YAAT,CAMA,IAAME,EAAQ1K,KAAKuB,UAAUoJ,aAAab,QAAO,SAAApF,GAAC,OAAKA,EAAEL,UAAYK,EAAEO,WAAad,EAAKe,wBAA0B,EAAK3D,UAAU8F,SAClI,GAAIqD,EAAMjL,OAAS,EAAG,CAClB,IAAMmL,EAAOrL,EAAcmL,GAC3B3H,QAAQ8H,IAAR,UAAeD,EAAK3F,WAAad,EAAKe,wBAAtC,cAAmElF,KAAKuB,UAAU8F,QAClFrH,KAAKwK,YAAcI,EACnB5K,KAAKuB,UAAU4E,QAAQyB,aAAvB,UAAuCgD,EAAKjL,KAA5C,wBACAK,KAAKyK,YAAc,EACnBG,EAAKE,WAAW9K,WAGhBA,KAAKuB,UAAU4E,QAAQyB,aAAvB,qCAfA5H,KAAKuB,UAAU4E,QAAQyB,aAAa,sCAjChD,mCAqDQ,OAAOvG,EAAWkJ,OArD1B,gCAyDQxH,QAAQ8H,IAAK,qBACb9H,QAAQgI,QACR,kEA3DR,+BA8Dc,IAAD,OAEL,GAAwB,MAApB/K,KAAKwK,cAKLxK,KAAKoI,mBAAmBpI,KAAKwK,aAAe,KAC5CxK,KAAKyK,cAGgB,KAArBzK,KAAKyK,aACLzK,KAAKuB,UAAU4E,QAAQyB,aAAvB,UAAuC5H,KAAKwK,YAAY7K,KAAxD,8BAEAK,KAAKyK,cAAgBrL,KAAKC,MAA8B,GAAxBkL,EAAKS,mBACrChL,KAAKuB,UAAU4E,QAAQyB,aAAvB,UAAuC5H,KAAKwK,YAAY7K,KAAxD,8BAEAK,KAAKyK,cAAgBrL,KAAKC,MAA8B,GAAxBkL,EAAKS,mBACrChL,KAAKuB,UAAU4E,QAAQyB,aAAvB,UAAuC5H,KAAKwK,YAAY7K,KAAxD,8BAEAK,KAAKyK,YAAcF,EAAKS,kBAAkB,CAC1ChL,KAAKwK,YAAYS,kBAMjB,IAHA,IAAMC,EAAgBhM,EAAU,GAAK,EAC/BiM,EAAQ,GACVC,EAASpL,KAAKwK,YACT5J,EAAI,EAAGA,EAAIsK,EAAetK,IAAK,CACpC,IAAMyD,EAAW,IAAIF,EAAKnE,KAAKuB,UAAWvB,KAAKwK,YAAY3K,EAAGG,KAAKwK,YAAY1K,EAAGmE,EAAS3E,UAAU,GACrG+E,EAASW,WAAaoG,EACtBpL,KAAKuB,UAAUmH,UAAUrE,GACzB+G,EAAS/G,EACTA,EAASP,QACTqH,EAAMxK,KAAK0D,EAAS1E,MAExBK,KAAKuB,UAAU4E,QAAQyB,aAAvB,UAAuC5H,KAAKwK,YAAY7K,KAAxD,8BAAkFwL,EAAM1L,OAAxF,gBACA0L,EAAMxB,SAAQ,SAAAhK,GACV,EAAK4B,UAAU4E,QAAQyB,aAAvB,kBAA+CjI,OAGnDK,KAAKwK,YAAc,UAtG/B,GAA0BlJ,GAAbiJ,EAKFS,iBAAmB,ICF9B,IAEaK,EAAb,kDAII,aAAe,IAAD,8BACV,cAAM,cAHV9J,eAEc,IAJlB,sDASQvB,KAAKuB,UAAYyH,EAAUsC,YAC3BtL,KAAKuB,UAAUI,MAAQ3B,KAETA,KAERuL,KAAKjF,KAAK,WAAY,oBAFdtG,KAGRuL,KAAKC,YAAY,oBAAqB,mCAAoC,CAAEC,WAAY,IAAKC,YAAa,MAHlG1L,KAIRuL,KAAKC,YAAY,QAAS,gCAAiC,CAAEC,WAAY,IAAKC,YAAa,MAJnF1L,KAKRuL,KAAK9J,MAAM,OAAQ,mBALXzB,KAORuL,KAAKC,YAAY,aAAc,oCAAqC,CAAEC,WAAY,IAAKC,YAAa,MAP5F1L,KAQRuL,KAAKC,YAAY,eAAgB,sCAAuC,CAAEC,WAAY,IAAKC,YAAa,MARhG1L,KASRuL,KAAKC,YAAY,aAAc,oCAAqC,CAAEC,WAAY,IAAKC,YAAa,MAT5F1L,KAURuL,KAAKC,YAAY,gBAAiB,uCAAwC,CAAEC,WAAY,IAAKC,YAAa,MAVlG1L,KAWRuL,KAAKC,YAAY,gBAAiB,uCAAwC,CAAEC,WAAY,IAAKC,YAAa,MAXlG1L,KAaRuL,KAAK9J,MAAM,QAAS,uBAbZzB,KAcRuL,KAAK9J,MAAM,SAAU,2BAdbzB,KAgBRuL,KAAK9J,MAAM,QAAS,oBAhBZzB,KAiBRuL,KAAK9J,MAAM,SAAU,qBAjBbzB,KAmBRuL,KAAKI,MAAM,WAAY,uBAnBf3L,KAoBRuL,KAAKI,MAAM,gBAAiB,4BApBpB3L,KAqBRuL,KAAKI,MAAM,WAAY,uBArBf3L,KAsBRuL,KAAKI,MAAM,gBAAiB,4BAtBpB3L,KAuBRuL,KAAKI,MAAM,WAAY,uBAvBf3L,KAwBRuL,KAAKI,MAAM,gBAAiB,4BAxBpB3L,KAyBRuL,KAAKI,MAAM,SAAU,qBAzBb3L,KA0BRuL,KAAKI,MAAM,cAAe,0BA1BlB3L,KA2BRuL,KAAKI,MAAM,SAAU,qBA3Bb3L,KA4BRuL,KAAKI,MAAM,cAAe,0BA5BlB3L,KA8BRuL,KAAKI,MAAM,WAAY,uBA9Bf3L,KAgCRuL,KAAKjF,KAAK,YAAa,2BA5CrC,+BAgDQtG,KAAKuB,UAAU0H,QAAUjJ,KAAKwF,MAAMoG,SAASC,mBAE7C7L,KAAKwF,MAAMsG,iBAAiB,2CAC5B9L,KAAKwF,MAAM3D,GAAG,eAAe,SAAUC,GACnC,IAAI9B,KAAKuB,UAAUuE,gBAGfhE,EAAQiK,iBAAkB,CAC1B,IAAMC,EAAQhM,KAAKuB,UAAUI,MAAM6H,QAAQC,KAAKC,cAAc5H,EAAQjC,EAAGiC,EAAQhC,GACjF6I,EAAKsD,YAAYjM,KAAKuB,UAAWyK,EAAMnM,EAAGmM,EAAMlM,EAAI,OAEzDE,MAEHA,KAAKkM,WAML,IAJA,IAIStL,EAAI,EAAGA,EADG,EACaA,IAAK,CACjC,IAAMuL,EAAanM,KAAKuB,UAAUkH,WAAWvJ,EAAUc,KAAKuB,UAAUkH,WAAWhJ,SAC3E2M,EAAiBnI,EAAS3E,SAEhCU,KAAKuB,UAAUmH,UAAU,IAAIvE,EAAKnE,KAAKuB,UAAW4K,EAAWtM,EAAGsM,EAAWrM,EAAGsM,IAGlF7B,EAAK8B,OAAOrM,KAAKuB,UAAW,KAAM,MAElCvB,KAAKuB,UAAUI,MAAM6H,QAAQC,KAAK6C,QAbjB,KAcjBtM,KAAKuB,UAAUI,MAAM6H,QAAQC,KAAK8C,QAbjB,IAcjBvM,KAAKuB,UAAUI,MAAM6H,QAAQC,KAAK+C,KAhFvB,GAkFXxM,KAAKqF,MAAMxD,GAAG,SAAU7B,KAAKyM,OAAQzM,MACrCA,KAAKyM,OAAO,CAACtC,MAAOnK,KAAKuB,UAAUI,MAAM6H,QAAQC,KAAKU,MAAOC,OAAQpK,KAAKuB,UAAUI,MAAM6H,QAAQC,KAAKU,OAAQ,KAAM,KAAM,MAE3HnK,KAAKuB,UAAUI,MAAM8F,MAAM7F,IAAI,YAAY8F,KAAK,CAAEC,OAAQ,GAAK+E,MAAM,MAnF7E,6BAuFWC,EAAUC,EAAUC,EAAaC,GAGpC,IAAI3C,EAAQwC,EAASxC,MACjBC,EAASuC,EAASvC,OAGhB2C,EADSC,EA/FJ,GAgGSL,EAASxC,MAC7BnK,KAAKuB,UAAUI,MAAM6H,QAAQC,KAAK+C,KAAO,EAAIO,EAE7C/M,KAAKuB,UAAUI,MAAM6H,QAAQC,KAAK6C,SAAmB,IAATnC,EAAgB,KAC5DnK,KAAKuB,UAAUI,MAAM6H,QAAQC,KAAK8C,SAAoB,IAAVnC,EAAiB,KAE7DpK,KAAKuB,UAAU4E,QAAQsG,WApG/B,+BA2GQ,GAHAzM,KAAKuB,UAAUqI,SACf5J,KAAKuB,UAAU0L,gBAEXjN,KAAKuB,UAAU+B,MAAM+F,cAAe,CACpC,IAAM9D,EAASvF,KAAKwF,MAAMoG,SAASC,mBAC/BtG,EAAO2H,KAAKC,SACZnN,KAAKuB,UAAUI,MAAM6H,QAAQC,KAAK6C,SAAW,IAE7C/G,EAAO6H,MAAMD,SACbnN,KAAKuB,UAAUI,MAAM6H,QAAQC,KAAK6C,SAAW,IAE7C/G,EAAO8H,GAAGF,SACVnN,KAAKuB,UAAUI,MAAM6H,QAAQC,KAAK8C,SAAW,IAE7ChH,EAAO+H,KAAKH,SACZnN,KAAKuB,UAAUI,MAAM6H,QAAQC,KAAK8C,SAAW,OAvH7D,iCAgJQ,IAlBA,IAAMgB,EAAOvN,KAAKuB,UAAUI,MAAM0E,MAAMC,KAAKC,IAAI,YAK3CiH,EAHYD,EAAKE,UAGW,EAC5BC,EAHaH,EAAKI,WAGY,EAE9BC,EAAQL,EAAKM,OAAO,GAAGN,KAEvBO,EAAWP,EAAKM,OAAO,GAAG1D,MAC1B4D,EAAYR,EAAKM,OAAO,GAAGzD,OAE3B4D,EAAUF,EAAWN,EAGvB5M,EAAI,EAECd,EAAI,EAAGA,EAAIiO,EAAWjO,IAC3B,IAAK,IAAID,EAAI,EAAGA,EAAIiO,EAAUjO,IAAK,CAC/B,IAAMoO,EAAKL,EAAMhN,GAAK,EAEhBsN,GAAMrO,EAAIC,GAAK0N,EACfW,GAAMtO,EAAIC,GAAK4N,EAEjBU,OAA8B,EAGvB,KAAPH,GAKAG,EAAOpO,KAAKuB,UAAUI,MAAMC,IAAIH,MAAMuM,EAAUE,EAnB5C,GAmB0DC,EAAI,SAElEnO,KAAKuB,UAAUkH,WAAW9H,KAAKyN,IAE/BA,EAAOpO,KAAKuB,UAAUI,MAAMC,IAAIH,MAAMuM,EAAUE,EAvB5C,GAuB0DC,EAAI,oBAAqBF,GAG3FG,EAAKhL,MA1BG,GA0Be+K,EACvBvN,SAvKhB,GAA+BG,SCPzBsN,EAAc,4DAEPC,EAAb,kDAkBI,aAAe,IAAD,8BACV,cAAM,CAAEC,IAAK,UAAW1J,QAAQ,KAhBpCtD,eAec,IAbdiN,gBAA8C,GAahC,EAXdC,kBAWc,IATdC,cAAgD,GASlC,EARdC,OAAS,GAQK,EAPdC,OAAS,IAOK,EANdC,aAAe,GAMD,EAJdC,eAAiB,EAIH,EAHdC,cAAgB,EAGF,EAlBlB,sDAuBQ/O,KAAKuB,UAAYyH,EAAUsC,YAC3BtL,KAAKuB,UAAU4E,QAAUnG,KAEzBA,KAAKyO,aAAezO,KAAKgP,QAAQ,MA1BzC,+BA8BQhP,KAAK8O,eAAiB9O,KAAKwJ,QAAQC,KAAKW,OACxCpK,KAAK+O,cAAgB/O,KAAKwJ,QAAQC,KAAKU,MACvCnK,KAAKiP,0BAhCb,+BAmCc,IAAD,OAGYjP,KAAKkP,SAASC,SACtBxF,SAAQ,SAAAyF,GACb,IAAMC,EAAKD,EAEX,GAAmB,iBAARC,EAAGxP,GAAgC,iBAARwP,EAAGvP,EAAe,CAEpD,IAAMwP,EAASD,EAAGxP,EAAI,EAAKkP,cACrBQ,EAASF,EAAGvP,EAAI,EAAKgP,eAE3BO,EAAGxP,EAAIyP,EAAS,EAAK9F,QAAQC,KAAKU,MAClCkF,EAAGvP,EAAIyP,EAAS,EAAK/F,QAAQC,KAAKW,WAG1CpK,KAAK+O,cAAgB/O,KAAKwJ,QAAQC,KAAKU,MACvCnK,KAAK8O,eAAiB9O,KAAKwJ,QAAQC,KAAKW,SApDhD,+BAyDQ,IAAIoF,EAAW,GACf,GAAIxP,KAAKuB,UAAU+B,MAAM4F,cAAe,CACpC,IAAMpH,EAAU9B,KAAKuB,UAAUgI,eACzBkG,EAAezP,KAAKuB,UAAUmO,4BACpCF,GAAQ,kBAAe1N,EAAQjC,EAAE8P,QAAQ,GAAjC,aAAwC7N,EAAQhC,EAAE6P,QAAQ,GAA1D,qBAAyEF,EAAa5P,EAAE8P,QAAQ,GAAhG,aAAuGF,EAAa3P,EAAE6P,QAAQ,GAA9H,SAEZ,GAAI3P,KAAKuB,UAAU+B,MAAM6F,mBAAoB,CACzC,IAAMyG,EAAS5P,KAAKuB,UAAUI,MAAM6H,QAAQC,KAC5C+F,GAAQ,yBAAsBI,EAAOzF,MAAMwF,QAAQ,GAA3C,aAAkDC,EAAOxF,OAAOuF,QAAQ,GAAxE,mCAAqGC,EAAOtD,QAAQqD,QAAQ,GAA5H,aAAmIC,EAAOrD,QAAQoD,QAAQ,GAA1J,SAEZ,GAAI3P,KAAKuB,UAAU+B,MAAM8F,qBAAsB,CAC3C,IAAMwG,EAAS5P,KAAKuB,UAAU4E,QAAQqD,QAAQC,KAC9C+F,GAAQ,4BAAyBI,EAAOzF,MAAMwF,QAAQ,GAA9C,aAAqDC,EAAOxF,OAAOuF,QAAQ,GAA3E,sCAA2GC,EAAOtD,QAAQqD,QAAQ,GAAlI,aAAyIC,EAAOrD,QAAQoD,QAAQ,GAAhK,SAGK,KAAbH,IACAxP,KAAKyO,aAAaoB,KAAOL,KAzErC,8CA+EQ,IAAMM,EAAe9P,KAAKgP,QAAQ,4BAA6B,GAC/Dc,EAAajQ,EAAIG,KAAK+P,gBAAgBD,GACtCA,EAAahQ,EAAKE,KAAKwJ,QAAQC,KAAKW,OAAS,EAC7C0F,EAAaE,MAAQ,EACrB,IAAMC,EAAcjQ,KAAKgP,QAAQ,0CAA2C,GAC5EiB,EAAYpQ,EAAIG,KAAK+P,gBAAgBE,GACrCA,EAAYnQ,EAAKE,KAAKwJ,QAAQC,KAAKW,OAAS,EAC5C6F,EAAYD,MAAQ,EACpB,IAAME,EAAclQ,KAAKgP,QAAQ,kDAAmD,GACpFkB,EAAYrQ,EAAIG,KAAK+P,gBAAgBG,GACrCA,EAAYpQ,EAAKE,KAAKwJ,QAAQC,KAAKW,OAAS,EAC5C8F,EAAYF,MAAQ,EAEpB,IAAMG,EAAWnQ,KAAKoQ,OAAOC,WAC7BF,EAASvO,IAAI,CACT0O,QAASR,EACTS,SAAU,IACVP,MAAO,IAENpO,IAAI,CACD0O,QAASR,EACTS,SAAU,MAEb3O,IAAI,CACD0O,QAASR,EACTS,SAAU,IACVP,MAAO,IAGVpO,IAAI,CACD0O,QAASR,EACTS,SAAU,IACVP,MAAO,IAEVpO,IAAI,CACD0O,QAASL,EACTM,SAAU,IACVP,MAAO,IAEVpO,IAAI,CACD0O,QAASL,EACTM,SAAU,MAEb3O,IAAI,CACD0O,QAASL,EACTM,SAAU,IACVP,MAAO,IAGVpO,IAAI,CACD0O,QAASL,EACTM,SAAU,IACVP,MAAO,IAEVpO,IAAI,CACD0O,QAASJ,EACTK,SAAU,IACVP,MAAO,IAEVpO,IAAI,CACD0O,QAASJ,EACTK,SAAU,MAEb3O,IAAI,CACD0O,QAASJ,EACTK,SAAU,IACVP,MAAO,IAEfG,EAASzI,SAnJjB,8BAsJYmI,GAA0D,IAA5CW,EAA2C,uDAA5B,EAC3BC,EAAazQ,KAAK4B,IAAIiO,KAAK,EAAG,EAAGA,EAAM,CAAEa,WAAYrC,EAAasC,SAAS,GAAD,OAAKH,EAAL,QAChF,OAAOC,IAxJf,0CA2JwBZ,EAAce,GAA6D,IAA5CJ,EAA2C,uDAA5B,EACxDC,EAAazQ,KAAKgP,QAAQa,EAAMW,GAEtC,OADAxQ,KAAK2F,KAAKC,YAAsB,IAAVgL,GAAgB,WAAQH,EAAWzO,YAAc,KAAM,MACtEyO,IA9Jf,sCAiKoB7F,GAKZ,IAAIiG,EACJ,GALA7Q,KAAKwO,gBAAgB7E,SAAQ,SAAAmH,GACzBA,EAAQ9O,aAIR4I,EAAKvG,SACLwM,EAAW,2BAEV,CACD,IAAME,EAAInG,EAAKxG,SACfyM,EAAQ,eAAWE,EAAEC,OAAO,GAAGC,cAAgBF,EAAEG,MAAM,GAA/C,UAGZ,IAAMvR,EAAOK,KAAKgP,QAAQpE,EAAKjL,KAAM,GAC/BwR,EAAQnR,KAAK4B,IAAIiO,KAAK,EAAG,EAAGgB,EAAU,CAAEH,WAAYrC,EAAasC,SAAU,MAAOS,UAAW,WAC7FrM,EAAU/E,KAAK4B,IAAIiO,KAAK,EAAG,EAAjB,4BAAyCjF,EAAK7F,SAAW,CAAE2L,WAAYrC,EAAasC,SAAU,MAAOS,UAAW,WAChIzR,EAAKE,EAAI,GACTF,EAAKG,EAA+B,IAA3BE,KAAKwJ,QAAQC,KAAKW,OAE3B+G,EAAMrR,EAAIH,EAAKG,EAAIH,EAAKyK,OAAyB,KAAf+G,EAAM/G,OACxC+G,EAAMtR,EAAIF,EAAKE,EAAIF,EAAKwK,MAAQ,GAChCpF,EAAQlF,EAAI,GACZkF,EAAQjF,EAAIH,EAAKG,EAAI,GAErBE,KAAKwO,gBAAkB,CAAC7O,EAAMwR,EAAOpM,KA1L7C,mCA6LiBsM,GAAkB,IAAD,OAEpBC,EAAQtR,KAAKgP,QAAQqC,GAC3BrR,KAAK2F,KAAKC,YAAYe,MAAc,WAChC,EAAK+H,cAAgB,EAAKA,cAAc5E,QAAO,SAAAyH,GAAC,OAAIA,IAAMD,KAC1DA,EAAMtP,UACN,EAAKwP,qBACN,KAAM,MACTxR,KAAK0O,cAAc/N,KAAK2Q,GACxBtR,KAAKwR,qBAtMb,yCA0MgC,IAAD,OACnB1R,EAAIE,KAAK4O,OACb5O,KAAK0O,cAAc/E,SAAQ,SAAA8H,GAEnB3R,EAA+B,IAA3B,EAAK0J,QAAQC,KAAKW,OACtBqH,EAAapO,YAAW,IAGxBoO,EAAapO,YAAW,GACxBoO,EAAa3R,EAAIA,EACjB2R,EAAa5R,EAAI,EAAK8O,OACtB7O,GAAK,EAAK+O,aAAe4C,EAAarH,aArNtD,sCA0N4BsH,GACpB,OAAQ1R,KAAKwJ,QAAQC,KAAKU,MAAQ,EAAMuH,EAAOvH,MAAQ,MA3N/D,GAA6BpJ,SCFhBiM,EAAe,KAEtB2E,EAA2C,CAC7CR,MAAO,YAEPS,KAAM7Q,OACNsE,MAAO,CACHwM,KAAM9Q,QAAa+Q,OACnB3H,MAAO,OACPC,OAAQ,QAEZ2H,OAAQ,iBACRpQ,MAAO,CAAE0J,EAAWiD,GACpB0D,gBAAiB,WAIJ,IAAIjR,OAAY4Q,GCfjC,IAuBeM,EAvBO,WACpB,OACE,yBAAKC,UAAU,OACb,+CACA,yBAAKA,UAAU,mBACb,yBAAKjE,GAAG,gBACN,yBAAKA,GAAG,qBAGZ,+FAAoE,uBAAGiE,UAAU,WAAWC,KAAK,2CAA2CxN,OAAO,SAASyN,IAAI,uBAA5F,qBAApE,KAPF,8BASE,4BACE,oEACA,yEACA,gEAEF,yBAAKnE,GAAG,UAAR,0BACyB,uBAAGiE,UAAU,WAAWC,KAAK,0CAA0CxN,OAAO,SAASyN,IAAI,uBAA3F,kBCXXC,QACW,cAA7BC,OAAOC,SAASC,UAEe,UAA7BF,OAAOC,SAASC,UAEhBF,OAAOC,SAASC,SAASC,MACvB,2DCZNC,IAASC,OAAO,kBAAC,EAAD,MAASC,SAASC,eAAe,SDmI3C,kBAAmBC,WACrBA,UAAUC,cAAcC,MAAMC,MAAK,SAAAC,GACjCA,EAAaC,kB","file":"static/js/main.519f4ab1.chunk.js","sourcesContent":["export function randomInt(max: number): number {\r\n    return Math.floor(Math.random() * Math.floor(max));\r\n}\r\n\r\nexport function randomElement<T>(array: Array<T>) : T {\r\n    const i = randomInt(array.length);\r\n    return array[i];\r\n}","import { randomInt } from \"./utils\";\r\n\r\nexport class Direction {\r\n\r\n    static west: Direction;\r\n    static northWest: Direction;\r\n    static north: Direction;\r\n    static northEast: Direction;\r\n    static east: Direction;\r\n    static southEast: Direction;\r\n    static south: Direction;\r\n    static southWest: Direction;\r\n\r\n    static map: Direction[];\r\n    static list: Direction[];\r\n\r\n    static initialise() {\r\n\r\n        Direction.west = new Direction('west', 0, -2, 0);\r\n        Direction.northWest = new Direction('northWest', 32, -2, -1);\r\n        Direction.north = new Direction('north', 64, 0, -2);\r\n        Direction.northEast = new Direction('northEast', 96, 2, -1);\r\n        Direction.east = new Direction('east', 128, 2, 0);\r\n        Direction.southEast = new Direction('southEast', 160, 2, 1);\r\n        Direction.south = new Direction('south', 192, 0, 2);\r\n        Direction.southWest = new Direction('southWest', 224, -2, 1);\r\n\r\n        Direction.west.opposite = Direction.east;\r\n        Direction.northWest.opposite = Direction.southEast;\r\n        Direction.north.opposite = Direction.south;\r\n        Direction.northEast.opposite = Direction.southWest;\r\n        Direction.east.opposite = Direction.west;\r\n        Direction.southEast.opposite = Direction.northWest;\r\n        Direction.south.opposite = Direction.north;\r\n        Direction.southWest.opposite = Direction.northEast;\r\n\r\n        Direction.map = [];\r\n        Direction.map[Direction.west.name] = Direction.west;\r\n        Direction.map[Direction.northWest.name] = Direction.northWest;\r\n        Direction.map[Direction.north.name] = Direction.north;\r\n        Direction.map[Direction.northEast.name] = Direction.northEast;\r\n        Direction.map[Direction.east.name] = Direction.east;\r\n        Direction.map[Direction.southEast.name] = Direction.southEast;\r\n        Direction.map[Direction.south.name] = Direction.south;\r\n        Direction.map[Direction.southWest.name] = Direction.southWest;\r\n\r\n        Direction.list = [];\r\n        Direction.list.push(Direction.west);\r\n        Direction.list.push(Direction.northWest);\r\n        Direction.list.push(Direction.north);\r\n        Direction.list.push(Direction.northEast);\r\n        Direction.list.push(Direction.east);\r\n        Direction.list.push(Direction.southEast);\r\n        Direction.list.push(Direction.south);\r\n        Direction.list.push(Direction.southWest);\r\n    }\r\n\r\n    static get(name: string): Direction {\r\n        return Direction.map[name];\r\n    }\r\n\r\n    static random(): Direction {\r\n        const i = randomInt(Direction.list.length);\r\n        return Direction.list[i];\r\n    }\r\n\r\n    static determineFromVector(vector: Phaser.Math.Vector2) {\r\n\r\n        const angle = Phaser.Math.Angle.Between(0, 0, Math.abs(vector.x), Math.abs(vector.y));\r\n\r\n        let quad = [];\r\n\r\n        // calculate quads for annoying trig and negative sign reasons. In phaser, 0,0 is top left so Y is inverted.\r\n\r\n        // top left quad\r\n        if (vector.x >= 0 && vector.y < 0) {\r\n            quad = [Direction.east, Direction.northEast, Direction.north];\r\n        }\r\n        // bottom left\r\n        else if (vector.x >= 0 && vector.y >= 0) {\r\n            quad = [Direction.east, Direction.southEast, Direction.south];\r\n        }\r\n        // top right\r\n        else if (vector.x < 0 && vector.y < 0) {\r\n            quad = [Direction.west, Direction.northWest, Direction.north];\r\n        }\r\n        // bottom right\r\n        else if (vector.x < 0 && vector.y >= 0) {\r\n            quad = [Direction.west, Direction.southWest, Direction.south];\r\n        }\r\n\r\n        let i = 0;\r\n        if (angle > 1.178097) { // 67.5 deg\r\n            i = 2;\r\n        }\r\n        else if (angle > 0.3926991) { // 22.5 deg\r\n            i = 1;\r\n        }\r\n\r\n        const direction = quad[i];\r\n        return direction;\r\n    }\r\n\r\n    name: string;\r\n    offset: number;\r\n    x: number;\r\n    y: number;\r\n    opposite: Direction;\r\n\r\n    constructor(name: string, offset: number, x: number, y: number) {\r\n        this.name = name;\r\n        this.offset = offset;\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n}\r\nDirection.initialise();\r\n","import { EntityType } from \"./entityType\";\r\nimport { GameState } from \"./gameState\";\r\n\r\nexport abstract class Entity {\r\n\r\n    image: Phaser.GameObjects.Image;\r\n    isDestroyed = false;\r\n    gameState: GameState;\r\n\r\n    constructor(gameState: GameState, imageName: string, x: number, y: number) {\r\n        this.image = gameState.scene.add.image(x, y, imageName);\r\n        this.gameState = gameState;\r\n\r\n        this.image.on('pointerdown', (pointer: Phaser.Input.Pointer) => {\r\n            this.onPointerDown(pointer)\r\n        });\r\n    }\r\n\r\n    abstract entityType(): EntityType;\r\n\r\n    onPointerDown(pointer: Phaser.Input.Pointer) {\r\n\r\n    }\r\n\r\n    update() {\r\n\r\n    }\r\n\r\n    destroy() {\r\n        this.isDestroyed = true;\r\n        if (this.image)\r\n            this.image.destroy();\r\n    }\r\n\r\n    distanceFromEntity(otherEntity: Entity) {\r\n        return Phaser.Math.Distance.Between(this.x, this.y, otherEntity.x, otherEntity.y);\r\n    }\r\n\r\n    vectorToEntity(entity: Entity, speed: number) {\r\n        return this.vectorToTarget(entity.x, entity.y, speed);\r\n    }\r\n\r\n    vectorToTarget(x: number, y: number, speed: number) {\r\n\r\n        const dx = x - this.x;\r\n        const dy = y - this.y;\r\n\r\n        const angle = Phaser.Math.Angle.Between(this.x, this.y, x, y);\r\n        let xR = Math.cos(angle);\r\n        let yR = Math.sin(angle);\r\n\r\n        const total =  Math.abs(xR) + Math.abs(yR);\r\n        let modX = (xR / total) * speed;\r\n        let modY = (yR / total) * speed;\r\n\r\n        if (modX > 10 || modY > 10) {\r\n\r\n            console.error(`Spurious vectorToTargetResult - C: ${x}, ${y} | A: ${Phaser.Math.RadToDeg(angle)} | ${dx}, ${dy} | ${modX}, ${modY}`);\r\n\r\n            if (modX > speed) {\r\n                modX = speed;\r\n            }\r\n            else if (modX < -speed) {\r\n                modX = -speed;\r\n            }\r\n\r\n            if (modY > speed) {\r\n                modY = speed;\r\n            }\r\n            else if (modY < -speed) {\r\n                modY = -speed;\r\n            }\r\n        }\r\n        return new Phaser.Math.Vector2(modX, modY);\r\n    }\r\n\r\n    get x() {\r\n        return this.image.x;\r\n    }\r\n    set x(x: number) {\r\n        this.image.x = x;\r\n    }\r\n\r\n    get y() {\r\n        return this.image.y;\r\n    }\r\n    set y(y: number) {\r\n        this.image.y = y;\r\n    }\r\n}\r\n","export enum EntityType {\r\n    Food,\r\n    Duck,\r\n    Invisible,\r\n    Nest\r\n}","import { Entity } from \"./entity\";\r\nimport { EntityType } from \"./entityType\";\r\nimport { GameState } from \"./gameState\";\r\n\r\nexport class InvisibleTarget extends Entity {\r\n\r\n    constructor(gameState: GameState, x: number, y: number) {\r\n        super(gameState, 'target', x, y);\r\n\r\n        this.image.depth = 10000;\r\n        this.image.setVisible(gameState.debug.showTargets);\r\n    }\r\n\r\n    entityType(): EntityType {\r\n        return EntityType.Invisible;\r\n    }\r\n\r\n    update() {\r\n    }\r\n}\r\n","import { Direction } from \"./direction\";\r\nimport { Entity } from \"./entity\";\r\nimport { EntityType } from \"./entityType\";\r\nimport { GameState } from \"./gameState\";\r\nimport { InvisibleTarget } from \"./invisibleTarget\";\r\nimport { Nest } from \"./nest\";\r\nimport { randomElement, randomInt } from \"./utils\";\r\n\r\nconst duckAnims = {\r\n    walk: {\r\n        startFrame: 0,\r\n        endFrame: 4,\r\n        speed: 0.20\r\n    },\r\n    feed: {\r\n        startFrame: 5,\r\n        endFrame: 7,\r\n        speed: 0.8\r\n    },\r\n    quack: {\r\n        startFrame: 8,\r\n        endFrame: 10,\r\n        speed: 0.6\r\n    },\r\n    stand: {\r\n        startFrame: 11,\r\n        endFrame: 13,\r\n        speed: 0.2\r\n    },\r\n    standFlap: {\r\n        startFrame: 14,\r\n        endFrame: 16,\r\n        speed: 0.2\r\n    }\r\n};\r\n\r\nexport class DuckType {\r\n    static duckTypes = [\r\n        \"white\",\r\n        \"mallard\",\r\n        \"brown\",\r\n        \"mandarin\"\r\n    ];\r\n\r\n    static random() {\r\n        return DuckType.duckTypes[randomInt(DuckType.duckTypes.length)];\r\n    }\r\n}\r\n\r\nexport class Duck extends Entity {\r\n\r\n    static QUACKS = [\r\n        \"quack-f1\",\r\n        \"quackquack-f1\",\r\n        \"quack-f2\",\r\n        \"quackquack-f2\",\r\n        \"quack-m1\",\r\n        \"quackquack-m1\"\r\n    ];\r\n\r\n    static CHIRPS = [\r\n        \"chirp1\",\r\n        \"chirpchirp1\",\r\n        \"chirp2\",\r\n        \"chirpchirp2\"\r\n    ];\r\n\r\n    /**\r\n     * Gets the age in ticks when a duckling should age into a duck.\r\n     */\r\n    static DUCKLING_MATURATION_AGE = 6000;\r\n\r\n    name = this.fetchName();\r\n\r\n    motion: any;\r\n    anim: any;\r\n    direction: Direction = Direction.random();\r\n    speed: number;\r\n\r\n    /**\r\n     * Frame.\r\n     */\r\n    f: number;\r\n\r\n    target: Entity = null;\r\n    vector: Phaser.Math.Vector2 = null;\r\n\r\n    animationStep = 1;\r\n\r\n    active = true;\r\n\r\n    idleTicks = 0;\r\n\r\n    thought: string = '';\r\n\r\n    /**\r\n     * The duck this duck should follow.\r\n     */\r\n    leaderDuck: Duck;\r\n\r\n    duckType: DuckType;\r\n\r\n    duckling: boolean;\r\n\r\n    lastNested = - 10 * Duck.DUCKLING_MATURATION_AGE;\r\n\r\n    /**\r\n     * Age of the duck in ticks.\r\n     */\r\n    age = 0;\r\n\r\n    private nesting = false;\r\n\r\n    constructor(gameState: GameState, x: number, y: number, duckType: string, duckling = false) {\r\n        super(gameState, duckling ? `duck-duckling` : `duck-${duckType}`, x, y);\r\n        if (duckling) {\r\n            this.image.scale = 0.4;\r\n        }\r\n        else {\r\n            this.image.scale = 0.8;\r\n        }\r\n\r\n        this.duckling = duckling;\r\n\r\n        this.image.setInteractive({ cursor: 'pointer' });\r\n        this.image.input.hitArea.setTo(128, 128, 512 - 128, 512 - 128);\r\n\r\n        this.duckType = duckType;\r\n        this.motion = 'walk';\r\n        this.anim = duckAnims[this.motion];\r\n        this.speed = this.anim.speed;\r\n        this.f = this.anim.startFrame;\r\n\r\n        this.gameState.scene.time.delayedCall(this.anim.speed * 1000, this.changeFrame, [], this);\r\n    };\r\n\r\n    onPointerDown(pointer: Phaser.Input.Pointer) {\r\n        this.gameState.pointerHandled = true;\r\n        pointer.event.stopImmediatePropagation();\r\n        this.startQuackAnimation();\r\n        this.quack();\r\n        this.thought = this.fetchThought();\r\n        this.gameState.uiScene.displayDuckInfo(this);\r\n    }\r\n\r\n    entityType(): EntityType {\r\n        return EntityType.Duck;\r\n    }\r\n\r\n    fetchName() {\r\n        const names = this.gameState.scene.cache.json.get('duck-data').duckNames as Array<string>;\r\n        return randomElement(names);\r\n    }\r\n\r\n    fetchThought() {\r\n        let thoughts: Array<string>;\r\n        if (this.duckling) {\r\n            thoughts = this.gameState.scene.cache.json.get('duck-data').ducklingThoughts as Array<string>;\r\n        }\r\n        else {\r\n            thoughts = this.gameState.scene.cache.json.get('duck-data').duckThoughts as Array<string>;\r\n        }\r\n        return randomElement(thoughts);\r\n    }\r\n\r\n    startWalkAnimation() {\r\n        this.f = duckAnims['walk'].startFrame;\r\n        this.anim = duckAnims['walk'];\r\n        this.animationStep = 1;\r\n        this.motion = 'walk';\r\n        this.changeFrame();\r\n        this.active = true;\r\n    }\r\n\r\n    startFeedAnimation() {\r\n        this.f = duckAnims['feed'].startFrame;\r\n        this.anim = duckAnims['feed'];\r\n        this.animationStep = 1;\r\n        this.motion = 'feed';\r\n        this.changeFrame();\r\n        this.active = false;\r\n    }\r\n\r\n    startQuackAnimation() {\r\n        this.f = duckAnims['quack'].startFrame;\r\n        this.anim = duckAnims['quack'];\r\n        this.animationStep = 1;\r\n        this.motion = 'quack';\r\n        this.changeFrame();\r\n        this.active = false;\r\n    }\r\n\r\n    startStandAnimation() {\r\n        this.f = duckAnims['stand'].startFrame;\r\n        this.anim = duckAnims['stand'];\r\n        this.animationStep = 1;\r\n        this.motion = 'stand';\r\n        this.changeFrame();\r\n        this.active = true;\r\n    }\r\n\r\n    startStandFlapAnimation() {\r\n        this.f = duckAnims['standFlap'].startFrame;\r\n        this.anim = duckAnims['standFlap'];\r\n        this.animationStep = 1;\r\n        this.motion = 'standFlap';\r\n        this.changeFrame();\r\n        this.active = true;\r\n    }\r\n\r\n    changeFrame() {\r\n\r\n        let delay = this.anim.speed;\r\n        this.image.depth = this.y + 256;\r\n        let localF = this.f;\r\n\r\n        if (this.f > this.anim.endFrame || this.f < 0 || this.f < this.anim.startFrame) {\r\n            switch (this.motion) {\r\n                case 'walk':\r\n                    this.animationStep = -this.animationStep;\r\n                    this.f += 2 * this.animationStep;\r\n                    localF = this.f;\r\n                    break;\r\n\r\n                case 'feed':\r\n                    this.gameState.scene.time.delayedCall(delay * 1000, this.startWalkAnimation, [], this);\r\n                    return;\r\n\r\n                case 'quack':\r\n                    localF = this.f - 4;\r\n                    if (this.f === 11) {\r\n                        localF = 9;\r\n                    }\r\n                    else if (this.f > 16) {\r\n                        this.startWalkAnimation();\r\n                        return;\r\n                    }\r\n                    this.gameState.scene.time.delayedCall(delay * 1000, this.startWalkAnimation, [], this);\r\n                    break;\r\n\r\n                case 'stand':\r\n                    this.startStandFlapAnimation();\r\n                    return;\r\n                case 'standFlap':\r\n                    this.f = this.anim.startFrame;\r\n                    localF = this.f;\r\n                    break;\r\n            }\r\n        }\r\n\r\n        this.image.frame = this.image.texture.get(this.direction.offset + localF);\r\n        this.gameState.scene.time.delayedCall(delay * 1000, this.changeFrame, [], this);\r\n        this.f += this.animationStep;\r\n    }\r\n\r\n    /**\r\n     * Moves the duck by the given amount, or returns false is fuck a movement isn't possible.\r\n     * @param modX Amount to move duck by.\r\n     * @param modY Amount to move duck by.\r\n     */\r\n    move(modX: number, modY: number): boolean {\r\n\r\n        if (this.gameState.isPointWater(this.x + modX, this.y + modY)) {\r\n            this.x += modX;\r\n            this.y += modY;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    sendToNest(nest: Nest) {\r\n\r\n        this.nesting = true;\r\n        this.target?.destroy();\r\n        this.target = nest;\r\n        this.vector = this.vectorToEntity(nest, 3);\r\n        this.direction = Direction.determineFromVector(this.vector);\r\n    }\r\n\r\n    nestingComplete() {\r\n        this.nesting = false;\r\n        this.target = null;\r\n        this.active = true;\r\n        this.lastNested = this.gameState.ticks;\r\n    }\r\n\r\n    quack() {\r\n        let quackTrack: string;\r\n        if (this.duckling) {\r\n            quackTrack = randomElement(Duck.CHIRPS);\r\n        }\r\n        else {\r\n            quackTrack = randomElement(Duck.QUACKS);\r\n        }\r\n        this.gameState.scene.sound.add(quackTrack).play({ volume: 0.2 });\r\n    }\r\n\r\n    update() {\r\n        this.age++;\r\n        if (this.duckling && this.age > Duck.DUCKLING_MATURATION_AGE) {\r\n\r\n            this.duckling = false;\r\n            this.leaderDuck = null;\r\n            this.target = null;\r\n            this.image.destroy();\r\n\r\n            this.image = this.gameState.scene.add.image(this.x, this.y, `duck-${this.duckType}`);\r\n            this.image.scale = 0.8;\r\n\r\n            this.gameState.uiScene.displayToast(`${this.name} is all grown up.`);\r\n        }\r\n\r\n        if (!this.active)\r\n            return;\r\n\r\n        // 0.05% chance to quack\r\n        if (randomInt(2000) === 1) {\r\n            this.quack();\r\n            this.startQuackAnimation();\r\n        }\r\n\r\n        if (this.leaderDuck != null) {\r\n            const oppDir = this.leaderDuck.direction.opposite;\r\n\r\n            const leaderOffset = 90;\r\n            const justBehindX = this.leaderDuck.x + leaderOffset * oppDir.x;\r\n            const justBehindY = this.leaderDuck.y + leaderOffset * oppDir.y;\r\n\r\n            this.vector = this.vectorToTarget(justBehindX, justBehindY, 1)\r\n            this.direction = Direction.determineFromVector(this.vector);\r\n        }\r\n\r\n        // find a target\r\n        if (this.target == null || this.target.isDestroyed || this.target.entityType() === EntityType.Invisible) {\r\n\r\n            // look for food\r\n            if (this.gameState.fetchFood().length > 0) {\r\n                const breadList = this.gameState.fetchFood().map(f => ({ distance: this.distanceFromEntity(f) + randomInt(30), target: f }));\r\n                const select = breadList.sort(f => f.distance).reverse()[0];\r\n                if (select.distance < 450) {\r\n\r\n                    this.target?.destroy();\r\n                    this.target = select.target;\r\n                    this.vector = this.vectorToEntity(this.target, 5);\r\n                    this.startStandAnimation();\r\n                }\r\n            }\r\n\r\n            // find a random point to swim too\r\n            if (this.target == null) {\r\n                // no bread, swim to random target\r\n                const waterTile = randomElement(this.gameState.waterTiles);\r\n                this.target = this.gameState.addEntity(new InvisibleTarget(this.gameState, waterTile.x, waterTile.y));\r\n\r\n                this.vector = this.vectorToEntity(this.target, 1);\r\n                this.startWalkAnimation();\r\n            }\r\n            this.direction = Direction.determineFromVector(this.vector);\r\n        }\r\n\r\n        if (!this.nesting && this.target != null && this.distanceFromEntity(this.target) < 2.5) {\r\n            this.target.destroy();\r\n\r\n            if (this.target.entityType() === EntityType.Food) {\r\n                this.startFeedAnimation();\r\n            }\r\n            this.target = null;\r\n            return;\r\n        }\r\n        if (this.nesting && this.distanceFromEntity(this.target) < 2.5) {\r\n            this.vector.x = 0;\r\n            this.vector.y = 0;\r\n            this.direction = Direction.west;\r\n            this.active = false;\r\n        }\r\n\r\n        this.x += this.vector.x;\r\n        this.y += this.vector.y;\r\n        this.image.depth = this.y + this.image.y;\r\n    }\r\n}\r\n","import { Entity } from \"./entity\";\r\nimport { EntityType } from \"./entityType\";\r\nimport { GameState } from \"./gameState\";\r\n\r\nexport class Food extends Entity {\r\n\r\n    static createBread(gameState: GameState, x: number, y: number): Food {\r\n\r\n        const bread = new Food(gameState, 'bread', x, y);\r\n        bread.image.scale = 0.6;\r\n        gameState.entities.push(bread);\r\n        return bread;\r\n    }\r\n\r\n    start = 0;\r\n\r\n    constructor(gameState: GameState, imageName: string, x: number, y: number) {\r\n        super(gameState, imageName, x, y);\r\n\r\n        this.image.depth = y + 32;\r\n    }\r\n\r\n    entityType(): EntityType {\r\n        return EntityType.Food;\r\n    }\r\n\r\n    update() {\r\n        this.start++;\r\n\r\n        if (this.start > 200) {\r\n            this.destroy();\r\n        }\r\n    }\r\n}\r\n","import { Duck } from \"./duck\";\r\nimport { Entity } from \"./entity\";\r\nimport { EntityType } from \"./entityType\";\r\nimport { Food } from \"./food\";\r\nimport { GameScene } from \"./gameScene\";\r\nimport { UiScene } from \"./uiScene\";\r\n\r\nexport class GameState {\r\n\r\n    private static _instance = null;\r\n    static singleton(): GameState {\r\n        if (GameState._instance == null) {\r\n            this._instance = new GameState();\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n    scene: GameScene;\r\n    uiScene: UiScene;\r\n    cursors: Phaser.Types.Input.Keyboard.CursorKeys;\r\n    entities: Array<Entity> = [];\r\n    waterTiles: Array<Phaser.GameObjects.Image> = [];\r\n    ticks = 0;\r\n\r\n    debug = {\r\n        showTargets: false,\r\n        showMouseData: true,\r\n        showResolutionData: true,\r\n        showUiResolutionData: true,\r\n        cameraPanning: true,\r\n    }\r\n\r\n    pointerHandled = false;\r\n\r\n    fetchPointer() {\r\n        return this.scene.input.activePointer;\r\n    }\r\n\r\n    fetchWorldPointerPosition() {\r\n        const pointer = this.fetchPointer();\r\n        const point = this.scene.cameras.main.getWorldPoint(pointer.x, pointer.y);\r\n        return point;\r\n    }\r\n\r\n    update() {\r\n        this.entities.forEach(entity => {\r\n            entity.update();\r\n        });\r\n\r\n        this.pointerHandled = false;\r\n        this.ticks++;\r\n    }\r\n\r\n    pruneEntities() {\r\n\r\n        const newEntities: Array<Entity> = [];\r\n        this.entities.forEach(entity => {\r\n            if (!entity.isDestroyed) {\r\n                newEntities.push(entity);\r\n            }\r\n        });\r\n        this.entities = newEntities;\r\n    }\r\n\r\n    fetchFood(): Food[] {\r\n        return this.entities.filter(e => e.entityType() === EntityType.Food && !e.isDestroyed) as Food[];\r\n    }\r\n\r\n    fetchDucks(): Duck[] {\r\n        return this.entities.filter(e => e.entityType() === EntityType.Duck && !e.isDestroyed) as Duck[];\r\n    }\r\n\r\n    addEntity(entity: Entity) {\r\n\r\n        this.entities.push(entity);\r\n        return entity;\r\n    }\r\n\r\n    showWaterCollision() {\r\n        for (let i = 0; i < this.waterTiles.length; i++) {\r\n            const tile = this.waterTiles[i];\r\n            const r = tile.getBounds();\r\n            this.scene.add.rectangle(r.x, r.y, r.width, r.height, 0x9966ff);\r\n        }\r\n    }\r\n\r\n    isPointWater(x: number, y: number) {\r\n        // collisions and drawing aren't aligned. no idea why.\r\n        for (let i = 0; i < this.waterTiles.length; i++) {\r\n            const tile = this.waterTiles[i];\r\n            if (tile.getBounds().contains(x + 60, y + 60)) {\r\n                this.scene.add.rectangle(x, y, 2, 2, 0xff0000);\r\n                return true;\r\n            }\r\n        }\r\n        this.scene.add.rectangle(x, y, 6, 6, 0x00ff00);\r\n        return false;\r\n    }\r\n}\r\n","import { Duck, DuckType } from \"./duck\";\r\nimport { Entity } from \"./entity\";\r\nimport { EntityType } from \"./entityType\";\r\nimport { GameState } from \"./gameState\";\r\nimport { randomElement, randomInt } from \"./utils\";\r\n\r\nexport class Nest extends Entity {\r\n\r\n    /**\r\n     * Gets duration a duck most nest for in ticks.\r\n     */\r\n    static NESTING_DURATION = 1000;\r\n\r\n    static create(gameState: GameState, x: number, y: number): Nest {\r\n\r\n        const nest = new Nest(gameState, 'nest', x, y);\r\n        gameState.addEntity(nest);\r\n        return nest;\r\n    }\r\n\r\n    private nestingDuck: Duck;\r\n\r\n    /**\r\n     * Gets how many ticks the current duck has nested for.\r\n     */\r\n    private nestingTime = 0;\r\n\r\n    constructor(gameState: GameState, imageName: string, x: number, y: number) {\r\n        super(gameState, imageName, x, y);\r\n\r\n        this.image.setInteractive({ cursor: 'pointer'});\r\n        this.image.depth = y + 200;\r\n        this.image.scale = 0.4;\r\n    }\r\n\r\n    onPointerDown(pointer: Phaser.Input.Pointer) {\r\n        this.gameState.pointerHandled = true;\r\n\r\n        if (this.nestingDuck != null) {\r\n            this.gameState.uiScene.displayToast(\"A duck is already nesting there.\");\r\n            return;\r\n        }\r\n\r\n        // choose a random non duckling\r\n        const ducks = this.gameState.fetchDucks().filter(f => !f.duckling && f.lastNested + Duck.DUCKLING_MATURATION_AGE < this.gameState.ticks);\r\n        if (ducks.length > 0) {\r\n            const duck = randomElement(ducks);\r\n            console.log(`${duck.lastNested + Duck.DUCKLING_MATURATION_AGE} | ${this.gameState.ticks}`);\r\n            this.nestingDuck = duck;\r\n            this.gameState.uiScene.displayToast(`${duck.name} is feeling broody.`);\r\n            this.nestingTime = 0;\r\n            duck.sendToNest(this);\r\n        }\r\n        else {\r\n            this.gameState.uiScene.displayToast(`No ducks are feeling broody.`);\r\n        }\r\n    }\r\n\r\n    entityType(): EntityType {\r\n        return EntityType.Nest;\r\n    }\r\n\r\n    destroy() {\r\n        console.log (\"nest destroyed!!!\");\r\n        console.trace();\r\n        super.destroy();\r\n    }\r\n\r\n    update() {\r\n\r\n        if (this.nestingDuck == null) {\r\n            return;\r\n        }\r\n\r\n        \r\n        if (this.distanceFromEntity(this.nestingDuck) < 2.5) {\r\n            this.nestingTime++;\r\n        }\r\n\r\n        if (this.nestingTime === 20) {\r\n            this.gameState.uiScene.displayToast(`${this.nestingDuck.name} has just started nesting`);\r\n        }\r\n        if (this.nestingTime === Math.floor(Nest.NESTING_DURATION * .5)) {\r\n            this.gameState.uiScene.displayToast(`${this.nestingDuck.name} has a while left to nest`);\r\n        }\r\n        if (this.nestingTime === Math.floor(Nest.NESTING_DURATION * 0.9)) {\r\n            this.gameState.uiScene.displayToast(`${this.nestingDuck.name} is feeling some rustling`);\r\n        }\r\n        if (this.nestingTime > Nest.NESTING_DURATION) {\r\n            this.nestingDuck.nestingComplete();\r\n\r\n            // generate some ducks\r\n            const ducklingCount = randomInt(5) + 1;\r\n            const names = [];\r\n            let leader = this.nestingDuck;\r\n            for (let i = 0; i < ducklingCount; i++) {\r\n                const duckling = new Duck(this.gameState, this.nestingDuck.x, this.nestingDuck.y, DuckType.random(), true);\r\n                duckling.leaderDuck = leader;\r\n                this.gameState.addEntity(duckling);\r\n                leader = duckling;\r\n                duckling.quack();\r\n                names.push(duckling.name);\r\n            }\r\n            this.gameState.uiScene.displayToast(`${this.nestingDuck.name} brood has hatched ${names.length} ducklings!`);\r\n            names.forEach(name => {\r\n                this.gameState.uiScene.displayToast(`Welcome ${name}`);\r\n            });\r\n\r\n            this.nestingDuck = null;\r\n        }\r\n    }\r\n}\r\n","import * as Phaser from 'phaser';\r\nimport { Duck, DuckType } from './duck';\r\nimport { Food } from './food';\r\nimport { TARGET_WIDTH } from './gameRunner';\r\nimport { GameState } from './gameState';\r\nimport { Nest } from './nest';\r\nimport { randomInt } from './utils';\r\n\r\n\r\nconst ZOOM_LEVEL = 0.4;\r\n\r\nexport class GameScene extends Phaser.Scene {\r\n\r\n    gameState: GameState;\r\n\r\n    constructor() {\r\n        super('GameScene');\r\n    }\r\n\r\n    preload() {\r\n        this.gameState = GameState.singleton();\r\n        this.gameState.scene = this;\r\n\r\n        const scene = this as Phaser.Scene;\r\n\r\n        scene.load.json('pond-map', 'assets/pond.json');\r\n        scene.load.spritesheet('landscape-tileset', 'assets/landscape-spritesheet.png', { frameWidth: 132, frameHeight: 100 });\r\n        scene.load.spritesheet('water', 'assets/landscapeTiles_066.png', { frameWidth: 132, frameHeight: 100 });\r\n        scene.load.image('nest', 'assets/nest.png');\r\n        \r\n        scene.load.spritesheet('duck-white', 'assets/duck-white-spritesheet.png', { frameWidth: 512, frameHeight: 512 });\r\n        scene.load.spritesheet('duck-mallard', 'assets/duck-mallard-spritesheet.png', { frameWidth: 512, frameHeight: 512 });\r\n        scene.load.spritesheet('duck-brown', 'assets/duck-brown-spritesheet.png', { frameWidth: 512, frameHeight: 512 });\r\n        scene.load.spritesheet('duck-mandarin', 'assets/duck-mandarin-spritesheet.png', { frameWidth: 512, frameHeight: 512 });\r\n        scene.load.spritesheet('duck-duckling', 'assets/duck-duckling-spritesheet.png', { frameWidth: 512, frameHeight: 512 });\r\n\r\n        scene.load.image('bread', 'assets/bread_NW.png');\r\n        scene.load.image('breadc', 'assets/bread_cursor.png');\r\n\r\n        scene.load.image('debug', 'assets/debug.png');\r\n        scene.load.image('target', 'assets/target.png');\r\n\r\n        scene.load.audio('quack-f1', 'assets/quack-f1.mp3');\r\n        scene.load.audio('quackquack-f1', 'assets/quackquack-f1.mp3');\r\n        scene.load.audio('quack-f2', 'assets/quack-f2.mp3');\r\n        scene.load.audio('quackquack-f2', 'assets/quackquack-f2.mp3');\r\n        scene.load.audio('quack-m1', 'assets/quack-m1.mp3');\r\n        scene.load.audio('quackquack-m1', 'assets/quackquack-m1.mp3');\r\n        scene.load.audio('chirp1', 'assets/chirp1.mp3');\r\n        scene.load.audio('chirpchirp1', 'assets/chirpchirp1.mp3');\r\n        scene.load.audio('chirp2', 'assets/chirp2.mp3');\r\n        scene.load.audio('chirpchirp2', 'assets/chirpchirp2.mp3');\r\n\r\n        scene.load.audio('ambience', 'assets/ambience.mp3');\r\n\r\n        scene.load.json('duck-data', 'assets/duck-data.json');\r\n    }\r\n\r\n    create() {\r\n        this.gameState.cursors = this.input.keyboard.createCursorKeys();\r\n\r\n        this.input.setDefaultCursor('url(assets/bread_cursor.png), crosshair');\r\n        this.input.on('pointerdown', function (pointer: Phaser.Input.Pointer) {\r\n            if (this.gameState.pointerHandled)\r\n                return;\r\n\r\n            if (pointer.leftButtonDown()) {\r\n                const point = this.gameState.scene.cameras.main.getWorldPoint(pointer.x, pointer.y);\r\n                Food.createBread(this.gameState, point.x, point.y + 40);\r\n            }\r\n        }, this);\r\n\r\n        this.buildMap();\r\n\r\n        const x_offset = 4550;\r\n        const y_offset = 2000;\r\n\r\n        const startDucks = 3;\r\n        for (let i = 0; i < startDucks; i++) {\r\n            const randomTile = this.gameState.waterTiles[randomInt(this.gameState.waterTiles.length)];\r\n            const randomDuckType = DuckType.random();\r\n\r\n            this.gameState.addEntity(new Duck(this.gameState, randomTile.x, randomTile.y, randomDuckType));\r\n        }\r\n\r\n        Nest.create(this.gameState, 7013, 2144);\r\n\r\n        this.gameState.scene.cameras.main.scrollX = x_offset;\r\n        this.gameState.scene.cameras.main.scrollY = y_offset;\r\n        this.gameState.scene.cameras.main.zoom = ZOOM_LEVEL;\r\n\r\n        this.scale.on('resize', this.resize, this);\r\n        this.resize({width: this.gameState.scene.cameras.main.width, height: this.gameState.scene.cameras.main.width}, null, null, null);\r\n\r\n        this.gameState.scene.sound.add('ambience').play({ volume: 0.2, loop: true });\r\n    }\r\n\r\n\r\n    resize(gameSize, baseSize, displaySize, resolution) {\r\n        // resets camera zoom and adjusts offset.\r\n\r\n        var width = gameSize.width;\r\n        var height = gameSize.height;\r\n\r\n        const target = TARGET_WIDTH / ZOOM_LEVEL;\r\n        const x2 = target / gameSize.width;\r\n        this.gameState.scene.cameras.main.zoom = 1 / x2;\r\n\r\n        this.gameState.scene.cameras.main.scrollX = width * -0.89 + 5898;\r\n        this.gameState.scene.cameras.main.scrollY = height * -0.52 + 2600;\r\n\r\n        this.gameState.uiScene.resize();\r\n    }\r\n\r\n    update() {\r\n        this.gameState.update();\r\n        this.gameState.pruneEntities();\r\n\r\n        if (this.gameState.debug.cameraPanning) {\r\n            const cursor = this.input.keyboard.createCursorKeys();\r\n            if (cursor.left.isDown) {\r\n                this.gameState.scene.cameras.main.scrollX -= 10;\r\n            }\r\n            if (cursor.right.isDown) {\r\n                this.gameState.scene.cameras.main.scrollX += 10;\r\n            }\r\n            if (cursor.up.isDown) {\r\n                this.gameState.scene.cameras.main.scrollY -= 10;\r\n            }\r\n            if (cursor.down.isDown) {\r\n                this.gameState.scene.cameras.main.scrollY += 10;\r\n            }\r\n        }\r\n    }\r\n\r\n    buildMap() {\r\n        //  Parse the data out of the map\r\n        const data = this.gameState.scene.cache.json.get('pond-map');\r\n\r\n        const tileWidth = data.tilewidth;\r\n        const tileHeight = data.tileheight;\r\n\r\n        const tileWidthHalf = tileWidth / 2;\r\n        const tileHeightHalf = tileHeight / 2;\r\n\r\n        const layer = data.layers[0].data;\r\n\r\n        const mapWidth = data.layers[0].width;\r\n        const mapHeight = data.layers[0].height;\r\n\r\n        const centerX = mapWidth * tileWidthHalf;\r\n        const centerY = 32;\r\n\r\n        let i = 0;\r\n\r\n        for (let y = 0; y < mapHeight; y++) {\r\n            for (let x = 0; x < mapWidth; x++) {\r\n                const id = layer[i] - 1;\r\n\r\n                const tx = (x - y) * tileWidthHalf;\r\n                const ty = (x + y) * tileHeightHalf;\r\n\r\n                let tile: Phaser.GameObjects.Image;\r\n\r\n                // 53 is water\r\n                if (id === 53) {\r\n                    //tile = gameState.scene.add.image(centerX + tx, centerY + ty, 'debug');\r\n\r\n                    // DIRTY HACK - the spritesheet has bleeding in some cases (specifically, I think the sheet is fine, but reading it somehow causes alignment problems).\r\n                    // Usually it's fine but water gets particular ugly at different zoom levels, so swap in a pure tile.\r\n                    tile = this.gameState.scene.add.image(centerX + tx, centerY + ty, 'water');\r\n                    //tile.setVisible(false);\r\n                    this.gameState.waterTiles.push(tile);\r\n                } else {\r\n                    tile = this.gameState.scene.add.image(centerX + tx, centerY + ty, 'landscape-tileset', id);\r\n                }\r\n\r\n                tile.depth = centerY + ty;\r\n                i++;\r\n            }\r\n        }\r\n    }\r\n}\r\n","import * as Phaser from 'phaser';\r\nimport { Duck } from './duck';\r\nimport { GameState } from './gameState';\r\n\r\nconst FONT_FAMILY = 'Perpetua , Georgia, \"Goudy Bookletter 1911\", Times, serif';\r\n\r\nexport class UiScene extends Phaser.Scene {\r\n\r\n\r\n    gameState: GameState;\r\n\r\n    duckInfoObjects: Array<{ destroy(): void }> = [];\r\n\r\n    debugMessage: Phaser.GameObjects.Text;\r\n\r\n    toastMessages: Array<Phaser.GameObjects.Text> = [];\r\n    toastX = 50;\r\n    toastY = 400;\r\n    toastYMargin = 15;\r\n\r\n    previousHeight = 0;\r\n    previousWidth = 0;\r\n\r\n\r\n    constructor() {\r\n        super({ key: 'UiScene', active: true });\r\n    }\r\n\r\n    preload() {\r\n        this.gameState = GameState.singleton();\r\n        this.gameState.uiScene = this;\r\n\r\n        this.debugMessage = this.addText('');\r\n    }\r\n\r\n    create() {\r\n        this.previousHeight = this.cameras.main.height;\r\n        this.previousWidth = this.cameras.main.width;\r\n        this.startBeginningMessage();\r\n    }\r\n\r\n    resize() {\r\n        // extremely crude way to make sure all UI elements are in the same relative position on the screen after it has been resized.\r\n        // It will not preserve alignment. If a text element was originally centred it is unlikely to be exactly centred after resize.\r\n        const children = this.children.getAll();\r\n        children.forEach(child => {\r\n            const ui = child as any;\r\n\r\n            if (typeof ui.x == 'number' && typeof ui.y == 'number') {\r\n\r\n                const ratioX = ui.x / this.previousWidth;\r\n                const ratioY = ui.y / this.previousHeight;\r\n\r\n                ui.x = ratioX * this.cameras.main.width;\r\n                ui.y = ratioY * this.cameras.main.height;\r\n            }\r\n        });\r\n        this.previousWidth = this.cameras.main.width;\r\n        this.previousHeight = this.cameras.main.height;\r\n    }\r\n\r\n    update() {\r\n\r\n        let debugMsg = '';\r\n        if (this.gameState.debug.showMouseData) {\r\n            const pointer = this.gameState.fetchPointer();\r\n            const worldPointer = this.gameState.fetchWorldPointerPosition();\r\n            debugMsg += `Mouse: (${pointer.x.toFixed(2)}, ${pointer.y.toFixed(2)}) World: (${worldPointer.x.toFixed(2)}, ${worldPointer.y.toFixed(2)})    `;\r\n        }\r\n        if (this.gameState.debug.showResolutionData) {\r\n            const camera = this.gameState.scene.cameras.main;\r\n            debugMsg += `Camera (w,h): (${camera.width.toFixed(2)}, ${camera.height.toFixed(2)}) Camera Offset (x,y): (${camera.scrollX.toFixed(2)}, ${camera.scrollY.toFixed(2)})    `;\r\n        }\r\n        if (this.gameState.debug.showUiResolutionData) {\r\n            const camera = this.gameState.uiScene.cameras.main;\r\n            debugMsg += `UI Camera (w,h): (${camera.width.toFixed(2)}, ${camera.height.toFixed(2)}) UI Camera Offset (x,y): (${camera.scrollX.toFixed(2)}, ${camera.scrollY.toFixed(2)})    `;\r\n        }\r\n\r\n        if (debugMsg !== '') {\r\n            this.debugMessage.text = debugMsg;\r\n        }\r\n\r\n    }\r\n\r\n    startBeginningMessage() {\r\n        const helloMessage = this.addText('Hello. This is your pond.', 6);\r\n        helloMessage.x = this.findMiddleWidth(helloMessage);\r\n        helloMessage.y = (this.cameras.main.height / 4);\r\n        helloMessage.alpha = 0;\r\n        const foodMessage = this.addText('Try feeding a duck. Press on the water.', 4);\r\n        foodMessage.x = this.findMiddleWidth(foodMessage);\r\n        foodMessage.y = (this.cameras.main.height / 4);\r\n        foodMessage.alpha = 0;\r\n        const nestMessage = this.addText('Ducks can nest. Press on the nest on the right.', 4);\r\n        nestMessage.x = this.findMiddleWidth(nestMessage);\r\n        nestMessage.y = (this.cameras.main.height / 4);\r\n        nestMessage.alpha = 0;\r\n\r\n        const timeLine = this.tweens.timeline();\r\n        timeLine.add({\r\n            targets: helloMessage,\r\n            duration: 2000,\r\n            alpha: 1\r\n        })\r\n            .add({\r\n                targets: helloMessage,\r\n                duration: 4000\r\n            })\r\n            .add({\r\n                targets: helloMessage,\r\n                duration: 2000,\r\n                alpha: 0\r\n            })\r\n            // identical tween for a delay\r\n            .add({\r\n                targets: helloMessage,\r\n                duration: 2000,\r\n                alpha: 0\r\n            })\r\n            .add({\r\n                targets: foodMessage,\r\n                duration: 2000,\r\n                alpha: 1\r\n            })\r\n            .add({\r\n                targets: foodMessage,\r\n                duration: 8000\r\n            })\r\n            .add({\r\n                targets: foodMessage,\r\n                duration: 2000,\r\n                alpha: 0\r\n            })\r\n            // identical tween for a delay\r\n            .add({\r\n                targets: foodMessage,\r\n                duration: 2000,\r\n                alpha: 0\r\n            })\r\n            .add({\r\n                targets: nestMessage,\r\n                duration: 2000,\r\n                alpha: 1\r\n            })\r\n            .add({\r\n                targets: nestMessage,\r\n                duration: 8000\r\n            })\r\n            .add({\r\n                targets: nestMessage,\r\n                duration: 2000,\r\n                alpha: 0\r\n            });\r\n        timeLine.play();\r\n    }\r\n\r\n    addText(text: string, size: number = 2): Phaser.GameObjects.Text {\r\n        const textObject = this.add.text(0, 0, text, { fontFamily: FONT_FAMILY, fontSize: `${size}em` });\r\n        return textObject;\r\n    }\r\n\r\n    addTextWithDuration(text: string, seconds: number, size: number = 2): Phaser.GameObjects.Text {\r\n        const textObject = this.addText(text, size);\r\n        this.time.delayedCall(seconds * 1000, () => { textObject.destroy(); }, null, null);\r\n        return textObject;\r\n    }\r\n\r\n    displayDuckInfo(duck: Duck) {\r\n        this.duckInfoObjects.forEach(element => {\r\n            element.destroy();\r\n        });\r\n\r\n        let titleMsg: string;\r\n        if (duck.duckling) {\r\n            titleMsg = \"(a duck in training)\";\r\n        }\r\n        else {\r\n            const s = duck.duckType as string;\r\n            titleMsg = `(the ${s.charAt(0).toUpperCase() + s.slice(1)} duck)`;\r\n        }\r\n\r\n        const name = this.addText(duck.name, 4);\r\n        const title = this.add.text(0, 0, titleMsg, { fontFamily: FONT_FAMILY, fontSize: '2em', fontStyle: 'italic' });\r\n        const thought = this.add.text(0, 0, `is thinking about ${duck.thought}`, { fontFamily: FONT_FAMILY, fontSize: '2em', fontStyle: 'italic' });\r\n        name.x = 40;\r\n        name.y = this.cameras.main.height * 0.75;\r\n\r\n        title.y = name.y + name.height - (title.height * 1.25);\r\n        title.x = name.x + name.width + 20;\r\n        thought.x = 80;\r\n        thought.y = name.y + 40;\r\n\r\n        this.duckInfoObjects = [name, title, thought];\r\n    }\r\n\r\n    displayToast(message: string) {\r\n        const delay = 15;\r\n        const toast = this.addText(message);\r\n        this.time.delayedCall(delay * 1000, () => {\r\n            this.toastMessages = this.toastMessages.filter(t => t !== toast);\r\n            toast.destroy();\r\n            this.repositionToasts();\r\n        }, null, null);\r\n        this.toastMessages.push(toast);\r\n        this.repositionToasts();\r\n\r\n    }\r\n\r\n    private repositionToasts() {\r\n        let y = this.toastY;\r\n        this.toastMessages.forEach(toastMessage => {\r\n\r\n            if (y > this.cameras.main.height * 0.75) { // don't display this many toasts\r\n                toastMessage.setVisible(false);\r\n            }\r\n            else {\r\n                toastMessage.setVisible(true);\r\n                toastMessage.y = y;\r\n                toastMessage.x = this.toastX;\r\n                y += this.toastYMargin + toastMessage.height;\r\n            }\r\n        });\r\n    }\r\n\r\n    private findMiddleWidth(object: { width: number }): number {\r\n        return (this.cameras.main.width / 2) - (object.width / 2);\r\n    }\r\n\r\n}\r\n","import * as Phaser from 'phaser';\r\nimport { GameScene } from './gameScene';\r\nimport { UiScene } from './uiScene';\r\n\r\nexport const TARGET_WIDTH = 1536;\r\n\r\nconst gameConfig: Phaser.Types.Core.GameConfig = {\r\n    title: 'duck-game',\r\n\r\n    type: Phaser.AUTO,\r\n    scale: {\r\n        mode: Phaser.Scale.RESIZE,\r\n        width: '100%',\r\n        height: '100%'\r\n    },\r\n    parent: \"game-container\",\r\n    scene: [ GameScene, UiScene ],\r\n    backgroundColor: '#000000',\r\n};\r\n\r\nexport function setupGame(): Phaser.Game {\r\n    const game = new Phaser.Game(gameConfig);\r\n    return game;\r\n}\r\n","import React from 'react';\r\nimport './App.css';\r\nimport * as Game from './game/gameRunner'\r\n\r\nGame.setupGame();\r\n\r\nconst App: React.FC = () => {\r\n  return (\r\n    <div className=\"App\">\r\n      <h1>Duck Pond-ering</h1>\r\n      <div className=\"centred-content\">\r\n        <div id=\"game-section\">\r\n          <div id=\"game-container\" />\r\n        </div>\r\n      </div>\r\n      <p>A pond with some hungry and slightly melancholy ducks. Built for <a className=\"App-link\" href=\"https://itch.io/jam/untitled-game-jam-37\" target=\"_blank\" rel=\"noopener noreferrer\">Untitled Game Jam</a>.</p>\r\n      Instructions for your pond:\r\n      <ul>\r\n        <li>Press on the water to feed the ducks</li>\r\n        <li>Press on the nest for a duck to lay eggs.</li>\r\n        <li>Press on a duck for duck facts.</li>\r\n      </ul>\r\n      <div id=\"footer\">\r\n        Duck Pond-ering 2020 - <a className=\"App-link\" href=\"https://github.com/RichTeaMan/duck-game\" target=\"_blank\" rel=\"noopener noreferrer\">Source Code</a>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}